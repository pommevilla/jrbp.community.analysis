<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Bacteria only</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="bacteria_community_analysis.html">Bacteria Only</a>
</li>
<li>
  <a href="yeast_community_analysis.html">Yeast Only</a>
</li>
<li>
  <a href="bacteria_yeast_community_analysis.html">Bacteria and Yeast</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bacteria only</h1>

</div>


<script>
$(document).ready(function() {
  $items = $('div#TOC li');
  $items.each(function(idx) {
    num_ul = $(this).parentsUntil('#TOC').length;
    $(this).css({'text-indent': num_ul * 10, 'padding-left': 0});
  });

});
</script>
<pre class="r"><code>library(data.table, warn.conflicts = FALSE)
library(igraph, warn.conflicts = FALSE)</code></pre>
<p><code>taxa</code> is the look-up table for the OTUs. <code>cooccurrence_data</code> contains pairwise Spearman correlation ranks for pairs of OTUs.</p>
<pre class="r"><code>taxa &lt;- data.table(read.delim(&quot;./data/bacteria/bacteria_classified_otus&quot;, 
                              sep = &quot;&quot;, header = TRUE))

head(taxa)</code></pre>
<pre><code>##         OTU   domain         phylum               class              order
## 1: OTU_4337 Bacteria Proteobacteria Gammaproteobacteria    Pseudomonadales
## 2:  OTU_893 Bacteria    Chloroflexi      Thermomicrobia       JG30-KF-CM45
## 3: OTU_4335 Bacteria Proteobacteria Alphaproteobacteria        Rhizobiales
## 4: OTU_2826 Bacteria            TM6               SJA-4                   
## 5: OTU_4333  Archaea  Euryarchaeota     Methanobacteria Methanobacteriales
## 6: OTU_4332  Archaea  Euryarchaeota                DSEG      HydGC-84-221A
##                family         genus
## 1:      Moraxellaceae Acinetobacter
## 2:                                 
## 3: Phyllobacteriaceae Mesorhizobium
## 4:                                 
## 5:                                 
## 6:</code></pre>
<pre class="r"><code>cooccurrence_data &lt;- data.table(read.table(&quot;./data/bacteria/bacteria_cooccurrence&quot;, 
                                    col.names = c(&quot;treatment&quot;, &quot;OTU_1&quot;, &quot;OTU_2&quot;, &quot;rho&quot;, &quot;p&quot;)))

head(cooccurrence_data)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho           p
## 1:    Bagged OTU_5142 OTU_5257 0.521706 1.62049e-05
## 2:    Bagged OTU_5142 OTU_3925 0.245753 5.62527e-02
## 3:    Bagged OTU_5142 OTU_2529 0.430690 5.30627e-04
## 4:    Bagged OTU_5142 OTU_5823 0.251251 5.07966e-02
## 5:    Bagged OTU_5142  OTU_162 0.449131 2.82600e-04
## 6:    Bagged OTU_5142 OTU_4153 0.368088 3.51595e-03</code></pre>
<p>We process <code>coocurrence_data</code> by removing OTU interactions non-significant <span class="math inline">\(\rho\)</span> values by filtering out those with a <span class="math inline">\(p\)</span>-value less than <span class="math inline">\(0.05\)</span>, then filtering out cyanobacteria and choloroplast data, as well as all observations from bird samples:</p>
<pre class="r"><code>cooccurrence_data &lt;- cooccurrence_data[p &lt;= 0.05, -5]      # Remove p-values from table
remove &lt;- taxa[which(taxa[[4]] %in% c(&quot;Cyanobacteria&quot;,&quot;Chloroplast&quot;)),]$OTU
taxa &lt;- taxa[-c(remove),]
complete_data &lt;- cooccurrence_data[-c(which(apply(cooccurrence_data, 1, function(x) any(remove %in% x)))),]

bird_data &lt;- cooccurrence_data[treatment == &quot;Bird&quot;, ]
complete_data &lt;- cooccurrence_data[treatment != &quot;Bird&quot;, ]</code></pre>
<p>We then remove all edges that are <span class="math inline">\(\textit{not}\)</span> connected to the indicated OTUs of interest:</p>
<pre class="r"><code>otus_of_interest &lt;- c(&quot;Acinetobacter&quot;, &quot;Gluconobacter&quot;, &quot;Neokomagataea&quot;, &quot;erwinia&quot;, &quot;Pantoea&quot;, &quot;resenbergiella&quot;, &quot;Asaia&quot;, &quot;Lactobacillus&quot;, &quot;Pseudomonas&quot;)
otus_of_interest &lt;- taxa[which(apply(taxa, 1, function(x) any(otus_of_interest %in% x))),]$OTU
trimmed_data &lt;- complete_data[which(apply(complete_data, 1, function(x) any(otus_of_interest %in% x))), ]
head(trimmed_data)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho
## 1:    Bagged OTU_5142  OTU_162 0.449131
## 2:    Bagged OTU_3559 OTU_4597 0.291322
## 3:    Bagged OTU_3559 OTU_4570 0.291322
## 4:    Bagged OTU_3559 OTU_4796 0.439302
## 5:    Bagged OTU_3559 OTU_2323 0.285776
## 6:    Bagged OTU_3559 OTU_5804 0.291322</code></pre>
<p>We seperate the coocurrence data into a positive and negative group.</p>
<pre class="r"><code>trimmed_positive_weights &lt;- trimmed_data[trimmed_data[[&#39;rho&#39;]] &gt; 0]
head(trimmed_positive_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho
## 1:    Bagged OTU_5142  OTU_162 0.449131
## 2:    Bagged OTU_3559 OTU_4597 0.291322
## 3:    Bagged OTU_3559 OTU_4570 0.291322
## 4:    Bagged OTU_3559 OTU_4796 0.439302
## 5:    Bagged OTU_3559 OTU_2323 0.285776
## 6:    Bagged OTU_3559 OTU_5804 0.291322</code></pre>
<pre class="r"><code>trimmed_negative_weights &lt;- trimmed_data[trimmed_data[[&#39;rho&#39;]] &lt; 0]
head(trimmed_negative_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2       rho
## 1:    Bagged OTU_5257    OTU_8 -0.253046
## 2:    Bagged OTU_4036 OTU_3492 -0.293861
## 3:    Bagged    OTU_6 OTU_3492 -0.254160
## 4:    Bagged    OTU_6 OTU_5398 -0.258791
## 5:    Bagged    OTU_6   OTU_21 -0.316472
## 6:    Bagged    OTU_6    OTU_5 -0.308091</code></pre>
<p>We’ll look at the positive and negative networks for each of the three treatments, as well as when all the treatments are combined together.</p>
<div id="trimmed-data" class="section level1">
<h1>Trimmed Data</h1>
<p>All the following analysis is performed on the trimmed data set. Specifically, this analysis only examines interactions between <em>Acinetobacter, Gluconobacter, Neokomagataea, erwinia, Pantoea, resenbergiella, Asaia, Lactobacillus, Pseudomonas</em></p>
<div id="exposed-communities" class="section level2">
<h2>Exposed Communities</h2>
<div id="positive-weights" class="section level3">
<h3>Positive weights</h3>
<p>We create a directed graph weighted by Spearman correlation for the Exposed treatment for those OTUs that are positively correlated to each other:</p>
<pre class="r"><code>exposed_data_positive &lt;- trimmed_positive_weights[treatment == &quot;Exposed&quot;]
exposed_data_positive &lt;- exposed_data_positive[, -1]
gr_exposed_positive &lt;- graph.data.frame(exposed_data_positive, directed = FALSE)
plot(gr_exposed_positive, vertex.size = 3,
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tep.1-1.png" width="672" /></p>
<p>To determine communities, we use <code>cluster_fast_greedy</code>, which does greedy (local) optimization of the graph’s modularity score.</p>
<pre class="r"><code>exposed_communities_greedy_positive &lt;- cluster_fast_greedy(gr_exposed_positive, weights = E(gr_exposed_positive)$rho)
plot(exposed_communities_greedy_positive, gr_exposed_positive, 
     layout = layout.fruchterman.reingold(gr_exposed_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tep.2-1.png" width="672" /> The modularity of the community structure is:</p>
<pre class="r"><code>tep.mod &lt;- modularity(gr_exposed_positive, membership(exposed_communities_greedy_positive))</code></pre>
<p>Note the community by itself. The members of this community are:</p>
<pre class="r"><code>communities(exposed_communities_greedy_positive)[[6]]</code></pre>
<pre><code>##  [1] &quot;OTU_3609&quot; &quot;OTU_345&quot;  &quot;OTU_5917&quot; &quot;OTU_4224&quot; &quot;OTU_304&quot;  &quot;OTU_86&quot;  
##  [7] &quot;OTU_609&quot;  &quot;OTU_556&quot;  &quot;OTU_965&quot;  &quot;OTU_2346&quot; &quot;OTU_736&quot;  &quot;OTU_678&quot; 
## [13] &quot;OTU_1228&quot; &quot;OTU_847&quot;  &quot;OTU_168&quot;  &quot;OTU_67&quot;   &quot;OTU_1919&quot; &quot;OTU_3510&quot;
## [19] &quot;OTU_231&quot;  &quot;OTU_186&quot;  &quot;OTU_3572&quot; &quot;OTU_5784&quot; &quot;OTU_1631&quot; &quot;OTU_5545&quot;
## [25] &quot;OTU_394&quot;  &quot;OTU_5047&quot; &quot;OTU_4397&quot; &quot;OTU_1741&quot; &quot;OTU_130&quot;  &quot;OTU_4680&quot;
## [31] &quot;OTU_1416&quot; &quot;OTU_571&quot;  &quot;OTU_591&quot;  &quot;OTU_287&quot;  &quot;OTU_3653&quot; &quot;OTU_4387&quot;
## [37] &quot;OTU_980&quot;  &quot;OTU_1476&quot; &quot;OTU_359&quot;  &quot;OTU_1243&quot; &quot;OTU_126&quot;  &quot;OTU_1702&quot;</code></pre>
<pre class="r"><code>taxa[OTU %in% communities(exposed_communities_greedy_positive)[[6]]]</code></pre>
<pre><code>##          OTU   domain         phylum                 class
##  1:   OTU_67 Bacteria Proteobacteria   Alphaproteobacteria
##  2:  OTU_847 Bacteria Proteobacteria   Alphaproteobacteria
##  3: OTU_3609 Bacteria Proteobacteria   Gammaproteobacteria
##  4: OTU_5047 Bacteria     Firmicutes               Bacilli
##  5:  OTU_609 Bacteria Actinobacteria        Actinobacteria
##  6:  OTU_287 Bacteria  Bacteroidetes            Cytophagia
##  7: OTU_1228 Bacteria Proteobacteria   Alphaproteobacteria
##  8:  OTU_678 Bacteria            OP3                koll11
##  9: OTU_1243 Bacteria  Bacteroidetes         [Saprospirae]
## 10:  OTU_345 Bacteria Proteobacteria   Gammaproteobacteria
## 11: OTU_4387 Bacteria     Firmicutes               Bacilli
## 12:  OTU_359 Bacteria            OD1                   ZB2
## 13: OTU_1476 Bacteria  Cyanobacteria Oscillatoriophycideae
## 14: OTU_3510 Bacteria Proteobacteria   Alphaproteobacteria
## 15: OTU_4397 Bacteria     Firmicutes               Bacilli
## 16:  OTU_591 Bacteria Proteobacteria    Betaproteobacteria
## 17: OTU_3572 Bacteria Proteobacteria   Alphaproteobacteria
## 18:  OTU_168 Bacteria Proteobacteria   Alphaproteobacteria
## 19:  OTU_186 Bacteria Proteobacteria   Alphaproteobacteria
## 20:  OTU_304 Bacteria Proteobacteria   Gammaproteobacteria
## 21:  OTU_980 Bacteria     Firmicutes               Bacilli
## 22: OTU_2346 Bacteria Actinobacteria        Actinobacteria
## 23: OTU_1631 Bacteria Proteobacteria   Alphaproteobacteria
## 24: OTU_4680 Bacteria  Bacteroidetes        Flavobacteriia
## 25: OTU_5784 Bacteria Proteobacteria   Alphaproteobacteria
## 26: OTU_4224 Bacteria Proteobacteria   Gammaproteobacteria
## 27: OTU_1741 Bacteria     Firmicutes               Bacilli
## 28:  OTU_126 Bacteria  Bacteroidetes      Sphingobacteriia
## 29:  OTU_231 Bacteria Proteobacteria   Alphaproteobacteria
## 30: OTU_3653 Bacteria Proteobacteria    Betaproteobacteria
## 31:  OTU_394 Bacteria Proteobacteria   Alphaproteobacteria
## 32: OTU_5545 Bacteria Proteobacteria   Alphaproteobacteria
## 33:  OTU_571 Bacteria     Firmicutes               Bacilli
## 34:   OTU_86 Bacteria Proteobacteria   Gammaproteobacteria
## 35:  OTU_736 Bacteria Actinobacteria        Actinobacteria
## 36: OTU_1702 Bacteria Proteobacteria    Betaproteobacteria
## 37:  OTU_965 Bacteria Actinobacteria        Actinobacteria
## 38: OTU_5917 Bacteria Proteobacteria   Gammaproteobacteria
## 39:  OTU_130 Bacteria Proteobacteria    Betaproteobacteria
## 40: OTU_1919 Bacteria Proteobacteria   Alphaproteobacteria
## 41: OTU_1416 Bacteria     Firmicutes               Bacilli
##          OTU   domain         phylum                 class
##                  order              family             genus
##  1:   Sphingomonadales  Erythrobacteraceae                  
##  2:    Caulobacterales    Caulobacteraceae         Mycoplana
##  3:  Oceanospirillales      Halomonadaceae         Halomonas
##  4:         Bacillales   Staphylococcaceae    Staphylococcus
##  5:    Actinomycetales  Corynebacteriaceae   Corynebacterium
##  6:       Cytophagales       Cytophagaceae      Hymenobacter
##  7:   Rhodospirillales    Acetobacteraceae        Roseomonas
##  8:                                                         
##  9:    [Saprospirales]    Chitinophagaceae                  
## 10:  Oceanospirillales      Halomonadaceae Haererehalobacter
## 11:         Bacillales         Bacillaceae     Anoxybacillus
## 12:                                                         
## 13:      Chroococcales       Xenococcaceae                  
## 14:   Sphingomonadales   Sphingomonadaceae                  
## 15:         Bacillales   Staphylococcaceae    Staphylococcus
## 16:    Burkholderiales      Comamonadaceae                  
## 17:        Rhizobiales   Bradyrhizobiaceae             Bosea
## 18:    Caulobacterales    Caulobacteraceae  Phenylobacterium
## 19:        Rhizobiales    Beijerinckiaceae                  
## 20:      Aeromonadales      Aeromonadaceae                  
## 21:         Bacillales    Paenibacillaceae     Paenibacillus
## 22:    Actinomycetales    Actinomycetaceae       Actinomyces
## 23:        Rhizobiales Methylobacteriaceae                  
## 24:   Flavobacteriales   Flavobacteriaceae    Flavobacterium
## 25:        Rhizobiales    Methylocystaceae                  
## 26:  Enterobacteriales  Enterobacteriaceae                  
## 27:    Lactobacillales    Lactobacillaceae     Lactobacillus
## 28: Sphingobacteriales Sphingobacteriaceae        Pedobacter
## 29:   Sphingomonadales   Sphingomonadaceae      Sphingomonas
## 30:    Burkholderiales    Oxalobacteraceae Janthinobacterium
## 31:      Rickettsiales        mitochondria                  
## 32:      Rickettsiales        mitochondria                  
## 33:         Bacillales    Paenibacillaceae     Paenibacillus
## 34:      Aeromonadales      Aeromonadaceae                  
## 35:    Actinomycetales    Actinomycetaceae               N09
## 36:    Burkholderiales    Oxalobacteraceae                  
## 37:    Actinomycetales    Dermabacteraceae   Brachybacterium
## 38:  Enterobacteriales  Enterobacteriaceae                  
## 39:    Burkholderiales    Oxalobacteraceae                  
## 40:   Sphingomonadales   Sphingomonadaceae                  
## 41:         Bacillales    Paenibacillaceae     Paenibacillus
##                  order              family             genus</code></pre>
<p>At the center of this community is <code>OTU_6</code>:</p>
<pre class="r"><code>taxa[OTU == &quot;OTU_6&quot;]</code></pre>
<pre><code>##      OTU   domain         phylum               class           order
## 1: OTU_6 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
##           family         genus
## 1: Moraxellaceae Acinetobacter</code></pre>
</div>
<div id="negative-weights" class="section level3">
<h3>Negative Weights</h3>
<p>We repeat the above process for the negatively correlated OTUs:</p>
<pre class="r"><code>exposed_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Exposed&quot;]
exposed_data_negative &lt;- exposed_data_negative[, -1]
exposed_data_negative[[3]] &lt;- abs(exposed_data_negative[[3]])
gr_exposed_negative &lt;- graph.data.frame(exposed_data_negative, directed = FALSE)
plot(gr_exposed_negative, vertex.size = 3,
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ten.1-1.png" width="672" /></p>
<pre class="r"><code>exposed_communities_greedy_negative &lt;- cluster_fast_greedy(gr_exposed_negative, weights = E(gr_exposed_negative)$rho)
plot(exposed_communities_greedy_negative, gr_exposed_negative, 
     layout = layout.fruchterman.reingold(gr_exposed_negative),
     vertex.size = 2, vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ten.2-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>ten.mod &lt;- modularity(gr_exposed_negative, membership(exposed_communities_greedy_negative))</code></pre>
<p>We again find <code>OTU_6</code> as the center of a community. Below are the OTUs in this community. Notice that they are mostly $:</p>
<pre class="r"><code>taxa[OTU %in% communities(exposed_communities_greedy_negative)[[1]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class             order
##  1: OTU_4337 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  2: OTU_5778 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  3: OTU_5776 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  4:    OTU_5 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
##  5: OTU_4191 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  6: OTU_5806 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  7: OTU_4036 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  8: OTU_3986 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  9: OTU_5834 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 10:   OTU_43 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 11: OTU_5701 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 12: OTU_4345 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##                 family         genus
##  1:      Moraxellaceae Acinetobacter
##  2:      Moraxellaceae Acinetobacter
##  3:      Moraxellaceae Acinetobacter
##  4:       mitochondria              
##  5:      Moraxellaceae Acinetobacter
##  6: Enterobacteriaceae              
##  7:      Moraxellaceae Acinetobacter
##  8:      Moraxellaceae Acinetobacter
##  9:      Moraxellaceae Acinetobacter
## 10:   Oxalobacteraceae   Cupriavidus
## 11:     Comamonadaceae              
## 12:      Moraxellaceae Acinetobacter</code></pre>
<p>Something else to note of interest is <code>OTU_5</code>, another <span class="math inline">\(\textit{Proteobacteria}\)</span>:</p>
<pre class="r"><code>taxa[OTU == &quot;OTU_5&quot;]</code></pre>
<pre><code>##      OTU   domain         phylum               class         order
## 1: OTU_5 Bacteria Proteobacteria Alphaproteobacteria Rickettsiales
##          family genus
## 1: mitochondria</code></pre>
<p>Of interest is that <code>OTU_5</code> is in its own cluster, separate from <code>OTU_6</code>, and that there is no overlap in their own communities. Though it is not shown here, we will see here that <code>OTU_5</code> plays a role similar to that of <code>OTU_6</code> - a highly central node in its own community.</p>
</div>
</div>
<div id="caged-communities" class="section level2">
<h2>Caged Communities</h2>
<div id="positive-weights-1" class="section level3">
<h3>Positive weights</h3>
<pre class="r"><code>plot(caged_communities_greedy_positive, gr_caged_positive, 
     layout = layout.fruchterman.reingold(gr_caged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
      )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tcp.2-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>tcp.mod &lt;- modularity(gr_caged_positive, membership(caged_communities_greedy_positive))</code></pre>
<p>We again find <code>OTU_6</code> as the central member of a cluster that is well-separated from the rest of the community. The OTUs in this cluster are:</p>
<pre class="r"><code>taxa[OTU %in% communities(caged_communities_greedy_positive)[[7]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class            order
## 1: OTU_3780 Bacteria Proteobacteria  Betaproteobacteria    Rhodocyclales
## 2:   OTU_50 Bacteria     Firmicutes             Bacilli       Bacillales
## 3:  OTU_120 Bacteria Actinobacteria      Actinobacteria  Actinomycetales
## 4: OTU_4191 Bacteria Proteobacteria Gammaproteobacteria  Pseudomonadales
## 5: OTU_3096 Bacteria Proteobacteria  Betaproteobacteria  Burkholderiales
## 6: OTU_5701 Bacteria Proteobacteria  Betaproteobacteria  Burkholderiales
## 7:    OTU_7 Bacteria  Bacteroidetes      Flavobacteriia Flavobacteriales
## 8:   OTU_27 Bacteria     Firmicutes             Bacilli  Lactobacillales
##               family           genus
## 1:    Rhodocyclaceae   Dechloromonas
## 2:       Bacillaceae                
## 3: Microbacteriaceae                
## 4:     Moraxellaceae   Acinetobacter
## 5:    Alcaligenaceae      Sutterella
## 6:    Comamonadaceae                
## 7:   [Weeksellaceae] Cloacibacterium
## 8:  Streptococcaceae   Streptococcus</code></pre>
</div>
<div id="negative-weights-1" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>caged_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Caged&quot;]
caged_data_negative &lt;- caged_data_negative[, -1]
caged_data_negative[[3]] &lt;- abs(caged_data_negative[[3]])
gr_caged_negative &lt;- graph.data.frame(caged_data_negative, directed = FALSE)
caged_communities_greedy_negative &lt;- cluster_fast_greedy(gr_caged_negative, weights = E(gr_caged_negative)$rho)
plot(caged_communities_greedy_negative, gr_caged_negative, 
     layout = layout.fruchterman.reingold(gr_caged_negative),
     vertex.size = 2, 
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tcn.1-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>tcn.mod &lt;- modularity(gr_caged_negative, membership(caged_communities_greedy_negative))</code></pre>
<p>The OTUs in the same community of <code>OTU_6</code> are:</p>
<pre class="r"><code>taxa[OTU %in% communities(caged_communities_greedy_negative)[[2]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class            order
## 1: OTU_5302 Bacteria Proteobacteria Alphaproteobacteria    Rickettsiales
## 2: OTU_4227 Bacteria Proteobacteria Alphaproteobacteria    Rickettsiales
## 3:    OTU_8 Bacteria Proteobacteria Alphaproteobacteria Rhodospirillales
##              family         genus
## 1:     mitochondria              
## 2:     mitochondria              
## 3: Acetobacteraceae Gluconobacter</code></pre>
<p>As mentioned above, we see <code>OTU_5</code> negatively correlated with <code>OTU_6</code> and as highly central node. While we don’t see <span class="math inline">\(\textit{Proteobacteria}\)</span> in the <code>OTU_6</code> cluster, the OTUs in the cluster of <code>OTU_5</code> are all <span class="math inline">\(\textit{Proteobacteria}\)</span>:</p>
<pre class="r"><code>taxa[OTU %in% communities(caged_communities_greedy_negative)[[1]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class           order
## 1:   OTU_20 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
## 2:    OTU_5 Bacteria Proteobacteria Alphaproteobacteria   Rickettsiales
## 3: OTU_4161 Bacteria Proteobacteria Alphaproteobacteria   Rickettsiales
## 4: OTU_3986 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
## 5: OTU_5834 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
##           family         genus
## 1: Moraxellaceae Acinetobacter
## 2:  mitochondria              
## 3:  mitochondria              
## 4: Moraxellaceae Acinetobacter
## 5: Moraxellaceae Acinetobacter</code></pre>
</div>
</div>
<div id="bagged-communities" class="section level2">
<h2>Bagged Communities</h2>
<div id="positive-weights-2" class="section level3">
<h3>Positive weights</h3>
<pre class="r"><code>bagged_data_positive &lt;- trimmed_positive_weights[treatment == &quot;Bagged&quot;]
bagged_data_positive &lt;- bagged_data_positive[, -1]
gr_bagged_positive &lt;- graph.data.frame(bagged_data_positive, directed = FALSE)
bagged_communities_greedy_positive &lt;- cluster_fast_greedy(gr_bagged_positive, weights = E(gr_bagged_positive)$rho)
plot(bagged_communities_greedy_positive, gr_bagged_positive, 
     layout = layout.fruchterman.reingold(gr_bagged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbp.1-1.png" width="672" /></p>
<p>The modularity score of the community structure is:</p>
<pre class="r"><code>tbp.mod &lt;- modularity(gr_bagged_positive, membership(bagged_communities_greedy_positive))</code></pre>
<p>For completeness, here are the OTUs in the same community as <code>OTU_6</code>:</p>
<pre class="r"><code>taxa[OTU %in% communities(bagged_communities_greedy_positive)[[1]]]</code></pre>
<pre><code>##          OTU   domain         phylum                 class
##  1: OTU_3426 Bacteria Proteobacteria    Betaproteobacteria
##  2: OTU_3425 Bacteria Proteobacteria    Betaproteobacteria
##  3: OTU_1035 Bacteria  Bacteroidetes      Sphingobacteriia
##  4: OTU_5709 Bacteria Proteobacteria    Betaproteobacteria
##  5: OTU_5708 Bacteria Proteobacteria    Betaproteobacteria
##  6: OTU_3153 Bacteria Proteobacteria   Alphaproteobacteria
##  7:   OTU_52 Bacteria Proteobacteria    Betaproteobacteria
##  8: OTU_1011 Bacteria Proteobacteria    Betaproteobacteria
##  9: OTU_1018 Bacteria Proteobacteria   Alphaproteobacteria
## 10: OTU_3930 Bacteria Proteobacteria   Alphaproteobacteria
## 11:   OTU_42 Bacteria  Bacteroidetes            Cytophagia
## 12:  OTU_994 Bacteria  Bacteroidetes            Cytophagia
## 13:  OTU_841 Bacteria Proteobacteria   Gammaproteobacteria
## 14: OTU_5074 Bacteria Proteobacteria   Gammaproteobacteria
## 15: OTU_3925 Bacteria Proteobacteria    Betaproteobacteria
## 16:   OTU_38 Bacteria Proteobacteria   Gammaproteobacteria
## 17:  OTU_479 Bacteria Proteobacteria   Alphaproteobacteria
## 18: OTU_5192 Bacteria Proteobacteria    Betaproteobacteria
## 19:  OTU_461 Bacteria     Firmicutes            Clostridia
## 20: OTU_5454 Bacteria Proteobacteria   Gammaproteobacteria
## 21: OTU_1228 Bacteria Proteobacteria   Alphaproteobacteria
## 22:   OTU_16 Bacteria Proteobacteria    Betaproteobacteria
## 23:   OTU_13 Bacteria Proteobacteria    Betaproteobacteria
## 24:  OTU_671 Bacteria Actinobacteria        Actinobacteria
## 25: OTU_4624 Bacteria Proteobacteria    Betaproteobacteria
## 26:  OTU_349 Bacteria Proteobacteria   Deltaproteobacteria
## 27: OTU_3429 Bacteria Proteobacteria   Gammaproteobacteria
## 28: OTU_5307 Bacteria Proteobacteria    Betaproteobacteria
## 29: OTU_5367 Bacteria Actinobacteria        Actinobacteria
## 30: OTU_1476 Bacteria  Cyanobacteria Oscillatoriophycideae
## 31:  OTU_582 Bacteria Proteobacteria   Alphaproteobacteria
## 32: OTU_3721 Bacteria Proteobacteria    Betaproteobacteria
## 33: OTU_2100 Bacteria Proteobacteria   Gammaproteobacteria
## 34:  OTU_596 Bacteria  Bacteroidetes      Sphingobacteriia
## 35:  OTU_786 Bacteria Proteobacteria    Betaproteobacteria
## 36: OTU_5113 Bacteria Actinobacteria        Actinobacteria
## 37: OTU_2169 Bacteria  Acidobacteria          Solibacteres
## 38:  OTU_329 Bacteria Proteobacteria   Alphaproteobacteria
## 39:  OTU_550 Bacteria Proteobacteria   Alphaproteobacteria
## 40:  OTU_158 Bacteria Proteobacteria   Deltaproteobacteria
## 41:  OTU_153 Bacteria     Firmicutes               Bacilli
## 42:  OTU_336 Bacteria Proteobacteria   Alphaproteobacteria
## 43:  OTU_338 Bacteria Proteobacteria   Gammaproteobacteria
## 44: OTU_5879 Bacteria Proteobacteria   Alphaproteobacteria
## 45: OTU_5878 Bacteria Proteobacteria   Gammaproteobacteria
## 46: OTU_5667 Bacteria Proteobacteria    Betaproteobacteria
## 47: OTU_2529 Bacteria Proteobacteria    Betaproteobacteria
## 48: OTU_1546 Bacteria Proteobacteria   Gammaproteobacteria
## 49: OTU_1084 Bacteria Proteobacteria                  TA18
## 50: OTU_1762 Bacteria Proteobacteria   Alphaproteobacteria
## 51: OTU_5702 Bacteria Proteobacteria    Betaproteobacteria
## 52:  OTU_502 Bacteria  Bacteroidetes        Flavobacteriia
## 53: OTU_5548 Bacteria Proteobacteria    Betaproteobacteria
## 54: OTU_3269 Bacteria Proteobacteria   Alphaproteobacteria
## 55: OTU_2132 Bacteria Actinobacteria        Actinobacteria
## 56:  OTU_510 Bacteria Proteobacteria    Betaproteobacteria
## 57: OTU_1741 Bacteria     Firmicutes               Bacilli
## 58: OTU_5447 Bacteria Proteobacteria    Betaproteobacteria
## 59:  OTU_126 Bacteria  Bacteroidetes      Sphingobacteriia
## 60: OTU_5623 Bacteria  Bacteroidetes        Flavobacteriia
## 61: OTU_4920 Bacteria Proteobacteria    Betaproteobacteria
## 62:  OTU_717 Bacteria  Bacteroidetes        Flavobacteriia
## 63:  OTU_711 Bacteria  Bacteroidetes        Flavobacteriia
## 64: OTU_1080 Bacteria  Bacteroidetes        Flavobacteriia
## 65: OTU_2718 Bacteria Proteobacteria   Alphaproteobacteria
## 66:   OTU_81 Bacteria     Firmicutes               Bacilli
## 67: OTU_5972 Bacteria Proteobacteria    Betaproteobacteria
## 68:  OTU_221 Bacteria Proteobacteria   Alphaproteobacteria
## 69: OTU_1708 Bacteria  Bacteroidetes         [Saprospirae]
## 70: OTU_1700 Bacteria     Firmicutes               Bacilli
## 71:  OTU_219 Bacteria       [Thermi]            Deinococci
## 72:  OTU_218 Bacteria  Acidobacteria  [Chloracidobacteria]
## 73: OTU_5745 Bacteria Proteobacteria    Betaproteobacteria
## 74: OTU_2748 Bacteria  Bacteroidetes           Bacteroidia
## 75:  OTU_130 Bacteria Proteobacteria    Betaproteobacteria
## 76: OTU_1759 Bacteria Proteobacteria   Alphaproteobacteria
## 77: OTU_5763 Bacteria Proteobacteria   Alphaproteobacteria
## 78: OTU_4759 Bacteria Proteobacteria    Betaproteobacteria
## 79: OTU_5029 Bacteria Proteobacteria    Betaproteobacteria
## 80:  OTU_355 Bacteria Proteobacteria   Gammaproteobacteria
##          OTU   domain         phylum                 class
##                  order              family             genus
##  1:    Burkholderiales      Comamonadaceae                  
##  2:    Burkholderiales      Comamonadaceae       Ramlibacter
##  3: Sphingobacteriales Sphingobacteriaceae  Sphingobacterium
##  4:      Rhodocyclales      Rhodocyclaceae          Zoogloea
##  5:    Burkholderiales      Comamonadaceae                  
##  6:   Sphingomonadales   Sphingomonadaceae   Novosphingobium
##  7:      Rhodocyclales      Rhodocyclaceae                  
##  8:    Burkholderiales      Comamonadaceae                  
##  9:    Rhodobacterales     Hyphomonadaceae                  
## 10:        Rhizobiales   Bradyrhizobiaceae                  
## 11:       Cytophagales       Cytophagaceae                  
## 12:       Cytophagales       Cytophagaceae      Hymenobacter
## 13:                                                         
## 14:  Oceanospirillales      Halomonadaceae        Candidatus
## 15:    Burkholderiales      Comamonadaceae       Methylibium
## 16:    Pseudomonadales    Pseudomonadaceae       Pseudomonas
## 17:    Rhodobacterales    Rhodobacteraceae        Paracoccus
## 18:    Burkholderiales      Comamonadaceae         Pelomonas
## 19:      Clostridiales   [Tissierellaceae]        Finegoldia
## 20:    Xanthomonadales    Xanthomonadaceae                  
## 21:   Rhodospirillales    Acetobacteraceae        Roseomonas
## 22:    Burkholderiales      Comamonadaceae     Aquabacterium
## 23:    Burkholderiales      Comamonadaceae        Acidovorax
## 24:    Actinomycetales    Mycobacteriaceae     Mycobacterium
## 25:    Burkholderiales      Comamonadaceae       Curvibacter
## 26:              MIZ46                                      
## 27:  Enterobacteriales  Enterobacteriaceae           Erwinia
## 28:    Burkholderiales      Comamonadaceae                  
## 29:    Actinomycetales  Intrasporangiaceae                  
## 30:      Chroococcales       Xenococcaceae                  
## 31:    Caulobacterales    Caulobacteraceae                  
## 32:    Burkholderiales    Oxalobacteraceae Janthinobacterium
## 33:    Pseudomonadales    Pseudomonadaceae       Pseudomonas
## 34: Sphingobacteriales                                      
## 35:    Burkholderiales      Comamonadaceae                  
## 36:    Actinomycetales   Microbacteriaceae   Salinibacterium
## 37:     Solibacterales                                      
## 38:    Caulobacterales    Caulobacteraceae                  
## 39:        Rhizobiales Methylobacteriaceae  Methylobacterium
## 40:       Myxococcales                                      
## 41:    Lactobacillales    Lactobacillaceae     Lactobacillus
## 42:        Rhizobiales Methylobacteriaceae                  
## 43:    Pseudomonadales    Pseudomonadaceae       Pseudomonas
## 44:        Rhizobiales                                      
## 45:    Pseudomonadales       Moraxellaceae     Acinetobacter
## 46:    Burkholderiales      Comamonadaceae                  
## 47:    Burkholderiales      Comamonadaceae                  
## 48:    Alteromonadales             211ds20                  
## 49:          PHOS-HD29                                      
## 50:   Sphingomonadales   Sphingomonadaceae      Sphingomonas
## 51:      Rhodocyclales      Rhodocyclaceae     Dechloromonas
## 52:   Flavobacteriales   Flavobacteriaceae    Flavobacterium
## 53:      Rhodocyclales      Rhodocyclaceae     Dechloromonas
## 54:   Sphingomonadales   Sphingomonadaceae      Sphingomonas
## 55:    Actinomycetales              ACK-M1                  
## 56:      Rhodocyclales      Rhodocyclaceae     Dechloromonas
## 57:    Lactobacillales    Lactobacillaceae     Lactobacillus
## 58:    Burkholderiales      Comamonadaceae        Acidovorax
## 59: Sphingobacteriales Sphingobacteriaceae        Pedobacter
## 60:   Flavobacteriales   Flavobacteriaceae    Flavobacterium
## 61:      Rhodocyclales      Rhodocyclaceae     Dechloromonas
## 62:   Flavobacteriales     [Weeksellaceae]  Chryseobacterium
## 63:   Flavobacteriales     [Weeksellaceae]   Elizabethkingia
## 64:   Flavobacteriales     [Weeksellaceae]  Chryseobacterium
## 65:    Caulobacterales    Caulobacteraceae                  
## 66:         Gemellales         Gemellaceae           Gemella
## 67:    Burkholderiales      Comamonadaceae     Limnohabitans
## 68:    Rhodobacterales    Rhodobacteraceae       Rhodobacter
## 69:    [Saprospirales]                                      
## 70:         Bacillales   Staphylococcaceae      Salinicoccus
## 71:      Deinococcales      Deinococcaceae       Deinococcus
## 72:               RB41           Ellin6075                  
## 73:    Burkholderiales      Comamonadaceae                  
## 74:      Bacteroidales      Bacteroidaceae       Bacteroides
## 75:    Burkholderiales    Oxalobacteraceae                  
## 76:      Rickettsiales        mitochondria                  
## 77:                                                         
## 78:    Burkholderiales      Comamonadaceae                  
## 79:    Burkholderiales      Comamonadaceae                  
## 80:  Oceanospirillales      Halomonadaceae         Halomonas
##                  order              family             genus</code></pre>
<p><code>OTU_5</code> was not present in this graph.</p>
<pre class="r"><code>&#39;OTU_5&#39; %in% V(gr_bagged_positive)$name</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="negative-weights-2" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>bagged_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Bagged&quot;]
bagged_data_negative &lt;- bagged_data_negative[, -1]
bagged_data_negative[[3]] &lt;- abs(bagged_data_negative[[3]])
gr_bagged_negative &lt;- graph.data.frame(bagged_data_negative, directed = FALSE)
bagged_communities_greedy_negative &lt;- cluster_fast_greedy(gr_bagged_negative, weights = E(gr_bagged_negative)$rho)
plot(bagged_communities_greedy_negative, gr_bagged_negative, 
     layout = layout.fruchterman.reingold(gr_bagged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbn.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>tbn.mod &lt;- modularity(gr_bagged_negative, membership(bagged_communities_greedy_negative))</code></pre>
<pre class="r"><code>taxa[OTU %in% communities(bagged_communities_greedy_negative)[[1]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class           order
## 1:    OTU_5 Bacteria Proteobacteria Alphaproteobacteria   Rickettsiales
## 2: OTU_4938 Bacteria Proteobacteria Alphaproteobacteria   Rickettsiales
## 3: OTU_5398 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
## 4:    OTU_6 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
##              family         genus
## 1:     mitochondria              
## 2:     mitochondria              
## 3: Pseudomonadaceae   Pseudomonas
## 4:    Moraxellaceae Acinetobacter</code></pre>
<pre class="r"><code>taxa[OTU %in% communities(bagged_communities_greedy_negative)[[2]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class             order
## 1: OTU_3478 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
## 2: OTU_5867 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 3:    OTU_8 Bacteria Proteobacteria Alphaproteobacteria  Rhodospirillales
## 4:    OTU_3 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 5: OTU_5257 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##                family         genus
## 1:       mitochondria              
## 2: Enterobacteriaceae              
## 3:   Acetobacteraceae Gluconobacter
## 4: Enterobacteriaceae       Erwinia
## 5:     Comamonadaceae     Pelomonas</code></pre>
</div>
</div>
<div id="all-treatments" class="section level2">
<h2>All Treatments</h2>
<p>We will now look at all treatments together. Note that data points from Bird samples have already been removed.</p>
<div id="positive-weights-3" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>trimmed_all_positive &lt;- trimmed_positive_weights[, -1]
gr_trimmed_all_positive &lt;- graph.data.frame(trimmed_all_positive, directed = FALSE)
trimmed_all_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_all_positive, 
                                    weights = E(gr_trimmed_all_positive)$rho)</code></pre>
<pre><code>## Error in cluster_fast_greedy(gr_trimmed_all_positive, weights = E(gr_trimmed_all_positive)$rho): At fast_community.c:639 : fast-greedy community finding works only on graphs without multiple edges, Invalid value</code></pre>
<p>Because all the treatments are being combined into one graph, there can be multiple (parallel) edges between OTUs. The clustering algorithm we have been using requires that there not be multiple edges between OTUs. We will collapse multiple edges by taking their mean - that is the mean correlation of the two OTUs across all treatments. (Are there potential problems with this collapsing rule?)</p>
<pre class="r"><code>gr_trimmed_all_positive &lt;- simplify(gr_trimmed_all_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_all_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_all_positive, 
                                    weights = E(gr_trimmed_all_positive)$rho)
plot(trimmed_all_positive_communities, gr_trimmed_all_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_all_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tap.2-1.png" width="672" /></p>
<p>What’s interesting here is that the graph has a lot of “spokes,” which hints at important OTUs.</p>
<p>Modularity score:</p>
<pre class="r"><code>tap.mod &lt;- modularity(gr_trimmed_all_positive, membership(trimmed_all_positive_communities))</code></pre>
</div>
<div id="negative-weights-3" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>trimmed_all_negative &lt;- trimmed_negative_weights[, -1]
trimmed_all_negative[[3]] &lt;- abs(trimmed_all_negative[[3]])
gr_trimmed_all_negative &lt;- graph.data.frame(trimmed_all_negative, directed = FALSE)
gr_trimmed_all_negative &lt;- simplify(gr_trimmed_all_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_all_negative_communities &lt;- cluster_fast_greedy(gr_trimmed_all_negative, 
                                    weights = E(gr_trimmed_all_negative)$rho)
plot(trimmed_all_negative_communities, gr_trimmed_all_negative, 
     layout = layout.fruchterman.reingold(gr_trimmed_all_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tan.1-1.png" width="672" /></p>
<p><code>OTU_6</code> is again in the center of a community. The members of that community are:</p>
<pre class="r"><code>taxa[OTU %in% communities(trimmed_all_negative_communities)[[2]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class
##  1: OTU_1035 Bacteria  Bacteroidetes    Sphingobacteriia
##  2: OTU_3950 Bacteria Proteobacteria  Betaproteobacteria
##  3:   OTU_45 Bacteria Proteobacteria Gammaproteobacteria
##  4:  OTU_446 Bacteria     Firmicutes          Clostridia
##  5:   OTU_16 Bacteria Proteobacteria  Betaproteobacteria
##  6: OTU_5629 Bacteria Proteobacteria Gammaproteobacteria
##  7: OTU_2168 Bacteria Proteobacteria Gammaproteobacteria
##  8:  OTU_336 Bacteria Proteobacteria Alphaproteobacteria
##  9: OTU_5247 Bacteria Proteobacteria Gammaproteobacteria
## 10:  OTU_233 Bacteria     Firmicutes             Bacilli
## 11: OTU_4938 Bacteria Proteobacteria Alphaproteobacteria
## 12: OTU_5854 Bacteria Proteobacteria  Betaproteobacteria
## 13: OTU_5398 Bacteria Proteobacteria Gammaproteobacteria
## 14:  OTU_225 Bacteria Proteobacteria Gammaproteobacteria
## 15: OTU_1076 Bacteria Actinobacteria      Actinobacteria
## 16:    OTU_9 Bacteria Proteobacteria Gammaproteobacteria
## 17:    OTU_6 Bacteria Proteobacteria Gammaproteobacteria
## 18:    OTU_7 Bacteria  Bacteroidetes      Flavobacteriia
##                  order              family            genus
##  1: Sphingobacteriales Sphingobacteriaceae Sphingobacterium
##  2:    Burkholderiales      Comamonadaceae      Methylibium
##  3:    Pseudomonadales       Moraxellaceae    Enhydrobacter
##  4:      Clostridiales  [Mogibacteriaceae]                 
##  5:    Burkholderiales      Comamonadaceae    Aquabacterium
##  6:  Enterobacteriales  Enterobacteriaceae                 
##  7:  Enterobacteriales  Enterobacteriaceae     Enterobacter
##  8:        Rhizobiales Methylobacteriaceae                 
##  9:  Enterobacteriales  Enterobacteriaceae                 
## 10:         Bacillales    Paenibacillaceae    Paenibacillus
## 11:      Rickettsiales        mitochondria                 
## 12:    Burkholderiales    Burkholderiaceae     Burkholderia
## 13:    Pseudomonadales    Pseudomonadaceae      Pseudomonas
## 14:    Pseudomonadales       Moraxellaceae    Acinetobacter
## 15:    Actinomycetales  Pseudonocardiaceae   Pseudonocardia
## 16:    Pseudomonadales    Pseudomonadaceae      Pseudomonas
## 17:    Pseudomonadales       Moraxellaceae    Acinetobacter
## 18:   Flavobacteriales     [Weeksellaceae]  Cloacibacterium</code></pre>
<p>And we see a preponderence of <span class="math inline">\(\textit{proteobacteria}\)</span>. We also see the familiar pattern with <code>OTU_5</code>. The OTUs in this cluster are:</p>
<pre class="r"><code>taxa[OTU %in% communities(trimmed_all_negative_communities)[[1]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class             order
##  1: OTU_4337 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  2:   OTU_44 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  3: OTU_5778 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  4: OTU_5776 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  5: OTU_3492 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  6:    OTU_5 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
##  7: OTU_4191 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  8: OTU_5806 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  9: OTU_4036 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 10: OTU_3986 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 11: OTU_5324 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 12: OTU_5834 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 13:   OTU_43 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 14: OTU_5701 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 15: OTU_4345 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##                 family         genus
##  1:      Moraxellaceae Acinetobacter
##  2:   Pseudomonadaceae   Pseudomonas
##  3:      Moraxellaceae Acinetobacter
##  4:      Moraxellaceae Acinetobacter
##  5: Enterobacteriaceae       Erwinia
##  6:       mitochondria              
##  7:      Moraxellaceae Acinetobacter
##  8: Enterobacteriaceae              
##  9:      Moraxellaceae Acinetobacter
## 10:      Moraxellaceae Acinetobacter
## 11:      Moraxellaceae Acinetobacter
## 12:      Moraxellaceae Acinetobacter
## 13:   Oxalobacteraceae   Cupriavidus
## 14:     Comamonadaceae              
## 15:      Moraxellaceae Acinetobacter</code></pre>
<p>Modularity score:</p>
<pre class="r"><code>tan.mod &lt;- modularity(gr_trimmed_all_negative, membership(trimmed_all_negative_communities))</code></pre>
</div>
</div>
</div>
<div id="complete-data" class="section level1">
<h1>Complete Data</h1>
<p>We reproduce the above analysis on the complete data sat. Again, we separate the data into positive and negative networks:</p>
<pre class="r"><code>complete_positive_weights &lt;- complete_data[complete_data[[&#39;rho&#39;]] &gt; 0]
head(complete_positive_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho
## 1:    Bagged OTU_5142 OTU_5257 0.521706
## 2:    Bagged OTU_5142 OTU_2529 0.430690
## 3:    Bagged OTU_5142  OTU_162 0.449131
## 4:    Bagged OTU_5142 OTU_4153 0.368088
## 5:    Bagged OTU_5142 OTU_3496 0.374365
## 6:    Bagged OTU_5142  OTU_304 0.310852</code></pre>
<pre class="r"><code>complete_negative_weights &lt;- complete_data[complete_data[[&#39;rho&#39;]] &lt; 0]
head(complete_negative_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2       rho
## 1:    Bagged OTU_3559 OTU_2168 -0.265843
## 2:    Bagged OTU_3559 OTU_5806 -0.253408
## 3:    Bagged OTU_5257    OTU_8 -0.253046
## 4:    Bagged OTU_5098 OTU_5970 -0.261365
## 5:    Bagged OTU_5098 OTU_1934 -0.261263
## 6:    Bagged OTU_2529 OTU_4227 -0.321220</code></pre>
<div id="exposed-communities-1" class="section level2">
<h2>Exposed Communities</h2>
<div id="positive-weights-4" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_exposed_positive &lt;- complete_positive_weights[treatment == &quot;Exposed&quot;]
complete_exposed_positive &lt;- complete_exposed_positive[, -1]
gr_complete_exposed_positive &lt;- graph.data.frame(complete_exposed_positive, directed = FALSE)
complete_exposed_positive_communities &lt;- cluster_fast_greedy(gr_complete_exposed_positive, 
                                                           weights = E(gr_complete_exposed_positive)$rho)
plot(complete_exposed_positive_communities, gr_complete_exposed_positive, 
     layout = layout.fruchterman.reingold(gr_complete_exposed_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cep.1-1.png" width="672" /> Modularity:</p>
<pre class="r"><code>cep.mod &lt;- modularity(gr_complete_exposed_positive, membership(complete_exposed_positive_communities))</code></pre>
</div>
<div id="negative-weights-4" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_exposed_negative &lt;- complete_negative_weights[treatment == &quot;Exposed&quot;]
complete_exposed_negative &lt;- complete_exposed_negative[, -1]
complete_exposed_negative[[3]] &lt;- abs(complete_exposed_negative[[3]])
gr_complete_exposed_negative &lt;- graph.data.frame(complete_exposed_negative, directed = FALSE)
complete_exposed_negative_communities &lt;- cluster_fast_greedy(gr_complete_exposed_negative, 
                                                           weights = E(gr_complete_exposed_negative)$rho)
plot(complete_exposed_negative_communities, gr_complete_exposed_negative, 
     layout = layout.fruchterman.reingold(gr_complete_exposed_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cen.1-1.png" width="672" /> Modularity:</p>
<pre class="r"><code>cen.mod &lt;- modularity(gr_complete_exposed_negative, membership(complete_exposed_negative_communities))</code></pre>
</div>
</div>
<div id="caged-communities-1" class="section level2">
<h2>Caged Communities</h2>
<div id="positive-weights-5" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_caged_positive &lt;- complete_positive_weights[treatment == &quot;Caged&quot;]
complete_caged_positive &lt;- complete_caged_positive[, -1]
gr_complete_caged_positive &lt;- graph.data.frame(complete_caged_positive, directed = FALSE)
complete_caged_positive_communities &lt;- cluster_fast_greedy(gr_complete_caged_positive, 
                                                           weights = E(gr_complete_caged_positive)$rho)
plot(complete_caged_positive_communities, gr_complete_caged_positive, 
     layout = layout.fruchterman.reingold(gr_complete_caged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ccp.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>ccp.mod &lt;- modularity(gr_complete_caged_positive, membership(complete_caged_positive_communities))</code></pre>
</div>
<div id="negative-weights-5" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_caged_negative &lt;- complete_negative_weights[treatment == &quot;Caged&quot;]
complete_caged_negative &lt;- complete_caged_negative[, -1]
complete_caged_negative[[3]] &lt;- abs(complete_caged_negative[[3]])
gr_complete_caged_negative &lt;- graph.data.frame(complete_caged_negative, directed = FALSE)
complete_caged_negative_communities &lt;- cluster_fast_greedy(gr_complete_caged_negative, 
                                                           weights = E(gr_complete_caged_negative)$rho)
plot(complete_caged_negative_communities, gr_complete_caged_negative, 
     layout = layout.fruchterman.reingold(gr_complete_caged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ccn.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>ccn.mod &lt;- modularity(gr_complete_caged_negative, membership(complete_caged_negative_communities))</code></pre>
<p>Again, the familiar pattern. However, <code>OTU_6</code> has lower centrality in its cluster while <code>OTU_5</code> remains highly central. The OTUs in the <code>OTU_6</code> cluster are:</p>
<pre class="r"><code>taxa[OTU %in% communities(complete_caged_negative_communities)[[1]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class            order
## 1: OTU_5302 Bacteria Proteobacteria Alphaproteobacteria    Rickettsiales
## 2: OTU_4227 Bacteria Proteobacteria Alphaproteobacteria    Rickettsiales
## 3: OTU_5702 Bacteria Proteobacteria  Betaproteobacteria    Rhodocyclales
## 4:  OTU_233 Bacteria     Firmicutes             Bacilli       Bacillales
## 5:    OTU_8 Bacteria Proteobacteria Alphaproteobacteria Rhodospirillales
## 6:    OTU_9 Bacteria Proteobacteria Gammaproteobacteria  Pseudomonadales
## 7:    OTU_6 Bacteria Proteobacteria Gammaproteobacteria  Pseudomonadales
## 8:    OTU_7 Bacteria  Bacteroidetes      Flavobacteriia Flavobacteriales
##              family           genus
## 1:     mitochondria                
## 2:     mitochondria                
## 3:   Rhodocyclaceae   Dechloromonas
## 4: Paenibacillaceae   Paenibacillus
## 5: Acetobacteraceae   Gluconobacter
## 6: Pseudomonadaceae     Pseudomonas
## 7:    Moraxellaceae   Acinetobacter
## 8:  [Weeksellaceae] Cloacibacterium</code></pre>
<p>In the <code>OTU_5</code> cluster:</p>
<pre class="r"><code>taxa[OTU %in% communities(complete_caged_negative_communities)[[3]]]</code></pre>
<pre><code>##          OTU   domain          phylum               class
##  1:   OTU_42 Bacteria   Bacteroidetes          Cytophagia
##  2: OTU_1205 Bacteria Verrucomicrobia    [Spartobacteria]
##  3: OTU_3733 Bacteria  Proteobacteria Alphaproteobacteria
##  4:    OTU_5 Bacteria  Proteobacteria Alphaproteobacteria
##  5: OTU_3505 Bacteria  Proteobacteria Gammaproteobacteria
##  6:  OTU_110 Bacteria  Proteobacteria Alphaproteobacteria
##  7: OTU_5838 Bacteria  Proteobacteria Alphaproteobacteria
##  8: OTU_3986 Bacteria  Proteobacteria Gammaproteobacteria
##  9: OTU_5616 Bacteria  Proteobacteria  Betaproteobacteria
## 10: OTU_5834 Bacteria  Proteobacteria Gammaproteobacteria
## 11:  OTU_148 Bacteria Verrucomicrobia      [Pedosphaerae]
## 12:  OTU_156 Bacteria  Proteobacteria  Betaproteobacteria
## 13:   OTU_43 Bacteria  Proteobacteria  Betaproteobacteria
## 14:  OTU_260 Bacteria  Proteobacteria Gammaproteobacteria
## 15: OTU_5939 Bacteria  Proteobacteria Gammaproteobacteria
## 16:    OTU_3 Bacteria  Proteobacteria Gammaproteobacteria
##                    order                family            genus
##  1:         Cytophagales         Cytophagaceae                 
##  2: [Chthoniobacterales] [Chthoniobacteraceae]                 
##  3:     Sphingomonadales     Sphingomonadaceae     Sphingomonas
##  4:        Rickettsiales          mitochondria                 
##  5:    Enterobacteriales    Enterobacteriaceae          Erwinia
##  6:          Rhizobiales    Phyllobacteriaceae                 
##  7:     Sphingomonadales     Sphingomonadaceae     Sphingomonas
##  8:      Pseudomonadales         Moraxellaceae    Acinetobacter
##  9:      Burkholderiales        Comamonadaceae        Comamonas
## 10:      Pseudomonadales         Moraxellaceae    Acinetobacter
## 11:     [Pedosphaerales]             auto67_4W                 
## 12:      Burkholderiales      Oxalobacteraceae Polynucleobacter
## 13:      Burkholderiales      Oxalobacteraceae      Cupriavidus
## 14:    Oceanospirillales        Halomonadaceae        Kushneria
## 15:    Enterobacteriales    Enterobacteriaceae       Klebsiella
## 16:    Enterobacteriales    Enterobacteriaceae          Erwinia</code></pre>
</div>
</div>
<div id="bagged-communities-1" class="section level2">
<h2>Bagged Communities</h2>
<div id="positive-weights-6" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_bagged_positive &lt;- complete_positive_weights[treatment == &quot;Bagged&quot;]
complete_bagged_positive &lt;- complete_bagged_positive[, -1]
gr_complete_bagged_positive &lt;- graph.data.frame(complete_bagged_positive, directed = FALSE)
complete_bagged_positive_communities &lt;- cluster_fast_greedy(gr_complete_bagged_positive, 
                                                           weights = E(gr_complete_bagged_positive)$rho)
plot(complete_bagged_positive_communities, gr_complete_bagged_positive, 
     layout = layout.fruchterman.reingold(gr_complete_bagged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbp.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>cbp.mod &lt;- modularity(gr_complete_bagged_positive, membership(complete_bagged_positive_communities))</code></pre>
</div>
<div id="negative-weights-6" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_bagged_negative &lt;- complete_negative_weights[treatment == &quot;Bagged&quot;]
complete_bagged_negative &lt;- complete_bagged_negative[, -1]
complete_bagged_negative[[3]] &lt;- abs(complete_bagged_negative[[3]])
gr_complete_bagged_negative &lt;- graph.data.frame(complete_bagged_negative, directed = FALSE)
complete_bagged_negative_communities &lt;- cluster_fast_greedy(gr_complete_bagged_negative, 
                                                           weights = E(gr_complete_bagged_negative)$rho)
plot(complete_bagged_negative_communities, gr_complete_bagged_negative, 
     layout = layout.fruchterman.reingold(gr_complete_bagged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbn.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>cbn.mod &lt;- modularity(gr_complete_bagged_negative, membership(complete_bagged_negative_communities))</code></pre>
<p>Same story as in the caged samples for the complete data. The <code>OTU_6</code> cluster:</p>
<pre class="r"><code>taxa[OTU %in% communities(complete_bagged_negative_communities)[[1]]]</code></pre>
<pre><code>##         OTU   domain         phylum               class             order
## 1:   OTU_21 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 2:   OTU_51 Bacteria Actinobacteria      Actinobacteria   Actinomycetales
## 3: OTU_3492 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 4: OTU_4036 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 5:  OTU_510 Bacteria Proteobacteria  Betaproteobacteria     Rhodocyclales
## 6:    OTU_6 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 7:  OTU_131 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##                family         genus
## 1:   Pseudomonadaceae   Pseudomonas
## 2:  Microbacteriaceae    Candidatus
## 3: Enterobacteriaceae       Erwinia
## 4:      Moraxellaceae Acinetobacter
## 5:     Rhodocyclaceae Dechloromonas
## 6:      Moraxellaceae Acinetobacter
## 7:      Moraxellaceae</code></pre>
<p>The <code>OTU_5</code> cluster:</p>
<pre class="r"><code>taxa[OTU %in% communities(complete_bagged_negative_communities)[[2]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class             order
##  1:   OTU_28 Bacteria  Bacteroidetes      Flavobacteriia  Flavobacteriales
##  2: OTU_4616 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  3: OTU_3646 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  4:    OTU_5 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
##  5: OTU_3509 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  6: OTU_5629 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  7: OTU_5795 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  8: OTU_5667 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  9: OTU_5247 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 10: OTU_4598 Bacteria     Firmicutes             Bacilli        Bacillales
## 11: OTU_5939 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 12:  OTU_233 Bacteria     Firmicutes             Bacilli        Bacillales
## 13: OTU_3603 Bacteria Actinobacteria      Actinobacteria   Actinomycetales
## 14: OTU_5745 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 15:   OTU_27 Bacteria     Firmicutes             Bacilli   Lactobacillales
## 16: OTU_4759 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 17: OTU_5443 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 18: OTU_3181 Bacteria Actinobacteria      Actinobacteria   Actinomycetales
##                 family            genus
##  1:    [Weeksellaceae] Chryseobacterium
##  2: Enterobacteriaceae       Klebsiella
##  3: Enterobacteriaceae                 
##  4:       mitochondria                 
##  5:   Oxalobacteraceae                 
##  6: Enterobacteriaceae                 
##  7: Enterobacteriaceae                 
##  8:     Comamonadaceae                 
##  9: Enterobacteriaceae                 
## 10:        Bacillaceae    Anoxybacillus
## 11: Enterobacteriaceae       Klebsiella
## 12:   Paenibacillaceae    Paenibacillus
## 13:  Microbacteriaceae                 
## 14:     Comamonadaceae                 
## 15:   Streptococcaceae    Streptococcus
## 16:     Comamonadaceae                 
## 17:   Oxalobacteraceae                 
## 18: Corynebacteriaceae  Corynebacterium</code></pre>
</div>
</div>
<div id="all-treatments-1" class="section level2">
<h2>All Treatments</h2>
<div id="positive-weights-7" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_all_positive &lt;- complete_positive_weights[, -1]
gr_complete_all_positive &lt;- graph.data.frame(complete_all_positive, directed = FALSE)
gr_complete_all_positive &lt;- simplify(gr_complete_all_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
complete_all_positive_communities &lt;- cluster_fast_greedy(gr_complete_all_positive, 
                                    weights = E(gr_complete_all_positive)$rho)
plot(complete_all_positive_communities, gr_complete_all_positive, 
     layout = layout.fruchterman.reingold(gr_complete_all_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cap.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>cap.mod &lt;- modularity(gr_complete_all_positive, membership(complete_all_positive_communities))</code></pre>
</div>
<div id="negative-weights-7" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_all_negative &lt;- complete_negative_weights[, -1]
complete_all_negative[[3]] &lt;- abs(complete_all_negative[[3]])
gr_complete_all_negative &lt;- graph.data.frame(complete_all_negative, directed = FALSE)
gr_complete_all_negative &lt;- simplify(gr_complete_all_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
complete_all_negative_communities &lt;- cluster_fast_greedy(gr_complete_all_negative, 
                                    weights = E(gr_complete_all_negative)$rho)
plot(complete_all_negative_communities, gr_complete_all_negative, 
     layout = layout.fruchterman.reingold(gr_complete_all_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/can.1-1.png" width="672" /> Same story, but the communities aren’t as distinct. The OTUs in the <code>OTU_6</code> cluster:</p>
<p>Modularity score:</p>
<pre class="r"><code>can.mod &lt;- modularity(gr_complete_all_negative, membership(complete_all_negative_communities))</code></pre>
<pre class="r"><code>taxa[OTU %in% communities(complete_all_negative_communities)[[2]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class             order
##  1:   OTU_21 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  2:   OTU_22 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  3:   OTU_44 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
##  4:   OTU_18 Bacteria     Firmicutes             Bacilli   Lactobacillales
##  5: OTU_5289 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
##  6:  OTU_669 Bacteria  Bacteroidetes          Cytophagia      Cytophagales
##  7: OTU_4153 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  8:  OTU_256 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  9:  OTU_164 Bacteria     Firmicutes             Bacilli        Bacillales
## 10: OTU_4191 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 11: OTU_4004 Bacteria  Bacteroidetes       [Saprospirae]   [Saprospirales]
## 12: OTU_5806 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 13:  OTU_172 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 14: OTU_4218 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 15:  OTU_510 Bacteria Proteobacteria  Betaproteobacteria     Rhodocyclales
## 16: OTU_5098 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 17:   OTU_88 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 18: OTU_5970 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
## 19:  OTU_131 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 20: OTU_1934 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
##                 family             genus
##  1:   Pseudomonadaceae       Pseudomonas
##  2:     Comamonadaceae        Variovorax
##  3:   Pseudomonadaceae       Pseudomonas
##  4:   Lactobacillaceae     Lactobacillus
##  5:       mitochondria                  
##  6:      Cytophagaceae    Flectobacillus
##  7: Enterobacteriaceae           Erwinia
##  8:   Oxalobacteraceae Janthinobacterium
##  9:   Paenibacillaceae     Paenibacillus
## 10:      Moraxellaceae     Acinetobacter
## 11:   Chitinophagaceae Sediminibacterium
## 12: Enterobacteriaceae                  
## 13:     Comamonadaceae        Rhodoferax
## 14:     Comamonadaceae        Rhodoferax
## 15:     Rhodocyclaceae     Dechloromonas
## 16:     Comamonadaceae         Comamonas
## 17:   Oxalobacteraceae                  
## 18: Enterobacteriaceae                  
## 19:      Moraxellaceae                  
## 20:       mitochondria</code></pre>
<pre class="r"><code>taxa[OTU %in% communities(complete_all_negative_communities)[[4]]]</code></pre>
<pre><code>##          OTU   domain         phylum               class             order
##  1:   OTU_60 Bacteria  Bacteroidetes      Flavobacteriia  Flavobacteriales
##  2:   OTU_23 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  3:   OTU_51 Bacteria Actinobacteria      Actinobacteria   Actinomycetales
##  4: OTU_3913 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##  5:   OTU_28 Bacteria  Bacteroidetes      Flavobacteriia  Flavobacteriales
##  6:  OTU_345 Bacteria Proteobacteria Gammaproteobacteria Oceanospirillales
##  7: OTU_5298 Bacteria Proteobacteria  Betaproteobacteria     Rhodocyclales
##  8: OTU_2168 Bacteria Proteobacteria Gammaproteobacteria Enterobacteriales
##  9: OTU_3559 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 10: OTU_1300 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
## 11:  OTU_267 Bacteria     Firmicutes             Bacilli        Bacillales
## 12:  OTU_253 Bacteria     Firmicutes             Bacilli        Bacillales
## 13: OTU_2079 Bacteria Actinobacteria      Actinobacteria   Actinomycetales
## 14: OTU_5976 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
## 15:  OTU_225 Bacteria Proteobacteria Gammaproteobacteria   Pseudomonadales
## 16:  OTU_214 Bacteria Proteobacteria Gammaproteobacteria   Xanthomonadales
## 17:   OTU_94 Bacteria Proteobacteria                TA18         PHOS-HD29
## 18: OTU_4508 Bacteria Proteobacteria Alphaproteobacteria     Rickettsiales
## 19: OTU_5257 Bacteria Proteobacteria  Betaproteobacteria   Burkholderiales
##                 family             genus
##  1:  Flavobacteriaceae    Flavobacterium
##  2:     Comamonadaceae       Tepidimonas
##  3:  Microbacteriaceae        Candidatus
##  4:     Comamonadaceae                  
##  5:    [Weeksellaceae]  Chryseobacterium
##  6:     Halomonadaceae Haererehalobacter
##  7:     Rhodocyclaceae               C39
##  8: Enterobacteriaceae      Enterobacter
##  9:     Comamonadaceae         Comamonas
## 10:       mitochondria                  
## 11:   Paenibacillaceae     Paenibacillus
## 12:        Bacillaceae   Natronobacillus
## 13:    Nocardioidaceae                  
## 14:     Comamonadaceae         Comamonas
## 15:      Moraxellaceae     Acinetobacter
## 16:   Xanthomonadaceae  Stenotrophomonas
## 17:                                     
## 18:       mitochondria                  
## 19:     Comamonadaceae         Pelomonas</code></pre>
</div>
</div>
<div id="patristic-distance-analysis" class="section level2">
<h2>Patristic Distance Analysis</h2>
<pre class="r"><code>library(ape, warn.conflicts = FALSE)</code></pre>
<pre class="r"><code>rough_tree &lt;- read.tree(&quot;./data/bacteria/bacteria_phylo_tree&quot;)</code></pre>
<p>Generate patristic distances from <code>OTU_6</code> to use as in the paper “Phylogenetic relatedness predicts priority effects in nectar yeast communities”</p>
<pre class="r"><code>pd_matrix &lt;- cophenetic.phylo(rough_tree)
rownames(pd_matrix) &lt;- sub(&quot;^[^_]*_&quot;, &quot;&quot;, rownames(pd_matrix)) 
colnames(pd_matrix) &lt;- sub(&quot;^[^_]*_&quot;, &quot;&quot;, colnames(pd_matrix))
otu_6.matrix &lt;- pd_matrix[&quot;OTU_6&quot;, ]
head(otu_6.matrix)</code></pre>
<pre><code>##    OTU_1 OTU_4369 OTU_4617 OTU_2588 OTU_4220 OTU_1527 
##  0.73186  0.73186  0.73186  0.73186  0.73186  0.73186</code></pre>
</div>
</div>
<div id="modularity" class="section level1">
<h1>Modularity</h1>
<p>Collecting all modularity scores:</p>
<pre class="r"><code>treatments &lt;- c(&quot;tep&quot;, &quot;ten&quot;, &quot;tcp&quot;, &quot;tcn&quot;, &quot;tbp&quot;, &quot;tbn&quot;, &quot;tap&quot;, &quot;tan&quot;,
                        &quot;cep&quot;, &quot;cen&quot;, &quot;ccp&quot;, &quot;ccn&quot;, &quot;cbp&quot;, &quot;cbn&quot;, &quot;cap&quot;, &quot;can&quot;)
scores &lt;- c(tep.mod, ten.mod, tcp.mod, tcn.mod, tbp.mod, tbn.mod, tap.mod, tan.mod,
            cep.mod, cen.mod, ccp.mod, ccn.mod, cbp.mod, cbn.mod, cap.mod, can.mod)
mod.scores &lt;- data.table(treatments, scores)


library(ggplot2, warn.conflicts = FALSE)
ggplot(mod.scores, aes(x = &quot;&quot;, y = scores)) + geom_boxplot() + 
    geom_jitter(shape = 16, aes(color = treatments))</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/mod.1-1.png" width="672" /></p>
</div>
<div id="birds" class="section level1">
<h1>Birds</h1>
<pre class="r"><code>bird_data &lt;- bird_data[, -1]
otus_of_interest &lt;- c(&quot;Acinetobacter&quot;, &quot;Gluconobacter&quot;, &quot;Neokomagataea&quot;, &quot;erwinia&quot;, &quot;Pantoea&quot;, &quot;resenbergiella&quot;, &quot;Asaia&quot;, &quot;Lactobacillus&quot;, &quot;Pseudomonas&quot;)
otus_of_interest &lt;- taxa[which(apply(taxa, 1, function(x) any(otus_of_interest %in% x))),]$OTU
trimmed_bird &lt;- bird_data[which(apply(complete_data, 1, function(x) any(otus_of_interest %in% x))),]</code></pre>
<div id="trimmed-data-1" class="section level2">
<h2>Trimmed Data</h2>
<div id="positive-weights-8" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>trimmed_bird_positive &lt;- trimmed_bird[trimmed_bird[[&#39;rho&#39;]] &gt; 0]
gr_trimmed_bird_positive &lt;- graph.data.frame(trimmed_bird_positive, directed = FALSE)
gr_trimmed_bird_positive &lt;- simplify(gr_trimmed_bird_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_bird_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_bird_positive, 
                                    weights = E(gr_trimmed_bird_positive)$rho)
plot(trimmed_bird_positive_communities, gr_trimmed_bird_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdp.1-1.png" width="672" /></p>
<pre class="r"><code>plot(trimmed_bird_positive_communities, gr_trimmed_bird_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label.cex = 1,
     vertex.label = ifelse(V(gr_trimmed_bird_positive)$name == &quot;OTU_6&quot;, 
                           V(gr_trimmed_bird_positive)$name, &quot;&quot;)
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdp.1-2.png" width="672" /></p>
<pre class="r"><code>adjacent_vertices(gr_trimmed_bird_positive, &quot;OTU_6&quot;)</code></pre>
<pre><code>## $OTU_6
## + 22/508 vertices, named, from da8f8fb:
##  [1] OTU_5778 OTU_5682 OTU_5324 OTU_4036 OTU_4191 OTU_4337 OTU_5213
##  [8] OTU_5834 OTU_3986 OTU_3906 OTU_4887 OTU_4570 OTU_4796 OTU_8   
## [15] OTU_5    OTU_28   OTU_4227 OTU_303  OTU_3464 OTU_3280 OTU_442 
## [22] OTU_928</code></pre>
<pre class="r"><code>degree(gr_trimmed_bird_positive, &quot;OTU_6&quot;)</code></pre>
<pre><code>## OTU_6 
##    22</code></pre>
</div>
<div id="negative-weights-8" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>trimmed_bird_negative &lt;- trimmed_bird[trimmed_bird[[&#39;rho&#39;]] &lt; 0]
trimmed_bird_negative[[3]] &lt;- abs(trimmed_bird_negative[[3]])
gr_trimmed_bird_negative &lt;- graph.data.frame(trimmed_bird_negative, directed = FALSE)
gr_trimmed_bird_negative &lt;- simplify(gr_trimmed_bird_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_bird_negative_communities &lt;- cluster_fast_greedy(gr_trimmed_bird_negative, 
                                    weights = E(gr_trimmed_bird_negative)$rho)
plot(trimmed_bird_negative_communities, gr_trimmed_bird_negative, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label.cex = 0.25
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdn.1-1.png" width="672" /></p>
<pre class="r"><code>gr_trimmed_bird_negative</code></pre>
<pre><code>## IGRAPH be4a39f UN-- 27 20 -- 
## + attr: name (v/c), rho (e/n)
## + edges from be4a39f (vertex names):
##  [1] OTU_1   --OTU_3225 OTU_17  --OTU_5629 OTU_5776--OTU_13  
##  [4] OTU_4036--OTU_13   OTU_4036--OTU_293  OTU_4191--OTU_172 
##  [7] OTU_3986--OTU_9    OTU_6   --OTU_338  OTU_6   --OTU_52  
## [10] OTU_6   --OTU_5755 OTU_20  --OTU_5629 OTU_20  --OTU_3   
## [13] OTU_20  --OTU_5917 OTU_20  --OTU_3505 OTU_5867--OTU_293 
## [16] OTU_4898--OTU_13   OTU_5806--OTU_23   OTU_5806--OTU_16  
## [19] OTU_338 --OTU_15   OTU_9   --OTU_8</code></pre>
<pre class="r"><code>taxa[OTU %in% c(&quot;OTU_4898&quot;, &quot;OTU_9&quot;)]</code></pre>
<pre><code>##      OTU   domain         phylum               class           order
## 1: OTU_9 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
##              family       genus
## 1: Pseudomonadaceae Pseudomonas</code></pre>
</div>
</div>
<div id="complete-data-1" class="section level2">
<h2>Complete Data</h2>
<div id="positive-weights-9" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>bird_positive &lt;- bird_data[bird_data[[&#39;rho&#39;]] &gt; 0]
gr_bird_positive &lt;- graph.data.frame(bird_positive, directed = FALSE)
gr_bird_positive &lt;- simplify(gr_bird_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
bird_positive_communities &lt;- cluster_fast_greedy(gr_bird_positive, 
                                    weights = E(gr_bird_positive)$rho)
plot(bird_positive_communities, gr_bird_positive, 
     layout = layout.fruchterman.reingold(gr_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbdp.1-1.png" width="672" /></p>
</div>
<div id="negative-weights-9" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>bird_negative &lt;- bird_data[bird_data[[&#39;rho&#39;]] &lt; 0]
bird_negative[[3]] &lt;- abs(bird_negative[[3]])
gr_bird_negative &lt;- graph.data.frame(bird_negative, directed = FALSE)
gr_bird_negative &lt;- simplify(gr_bird_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
bird_negative_communities &lt;- cluster_fast_greedy(gr_bird_negative, 
                                    weights = E(gr_bird_negative)$rho)
plot(bird_negative_communities, gr_bird_negative, 
     layout = layout.fruchterman.reingold(gr_bird_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbdn.1-1.png" width="672" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
