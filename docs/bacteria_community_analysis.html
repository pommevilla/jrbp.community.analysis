<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Bacteria only</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="bacteria_community_analysis.html">Bacteria Only</a>
</li>
<li>
  <a href="yeast_community_analysis.html">Yeast Only</a>
</li>
<li>
  <a href="curate_combine_bacteria_yeast.html">Combine Bac. and Yeast</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bacteria only</h1>

</div>


<script>
$(document).ready(function() {
  $items = $('div#TOC li');
  $items.each(function(idx) {
    num_ul = $(this).parentsUntil('#TOC').length;
    $(this).css({'text-indent': num_ul * 10, 'padding-left': 0});
  });

});
</script>
<div id="data-preparation" class="section level1">
<h1>Data Preparation</h1>
<pre class="r"><code>library(data.table, warn.conflicts = FALSE)
library(igraph, warn.conflicts = FALSE)</code></pre>
<p><code>taxa</code> is the look-up table for the OTUs. <code>cooccurrence_data</code> contains pairwise Spearman correlation ranks for pairs of OTUs.</p>
<pre class="r"><code>taxa &lt;- data.table(read.delim(&quot;./data/bacteria/bacteria_classified_otus&quot;, 
                              sep = &quot;&quot;, header = TRUE))

head(taxa)</code></pre>
<pre><code>##         OTU   domain         phylum               class              order
## 1: OTU_4337 Bacteria Proteobacteria Gammaproteobacteria    Pseudomonadales
## 2:  OTU_893 Bacteria    Chloroflexi      Thermomicrobia       JG30-KF-CM45
## 3: OTU_4335 Bacteria Proteobacteria Alphaproteobacteria        Rhizobiales
## 4: OTU_2826 Bacteria            TM6               SJA-4                   
## 5: OTU_4333  Archaea  Euryarchaeota     Methanobacteria Methanobacteriales
## 6: OTU_4332  Archaea  Euryarchaeota                DSEG      HydGC-84-221A
##                family         genus
## 1:      Moraxellaceae Acinetobacter
## 2:                                 
## 3: Phyllobacteriaceae Mesorhizobium
## 4:                                 
## 5:                                 
## 6:</code></pre>
<pre class="r"><code>cooccurrence_data &lt;- data.table(read.table(&quot;./data/bacteria/bacteria_cooccurrence&quot;, 
                                           col.names = c(&quot;treatment&quot;, &quot;OTU_1&quot;, &quot;OTU_2&quot;, &quot;rho&quot;, &quot;p&quot;)))

head(cooccurrence_data)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho           p
## 1:    Bagged OTU_5142 OTU_5257 0.521706 1.62049e-05
## 2:    Bagged OTU_5142 OTU_3925 0.245753 5.62527e-02
## 3:    Bagged OTU_5142 OTU_2529 0.430690 5.30627e-04
## 4:    Bagged OTU_5142 OTU_5823 0.251251 5.07966e-02
## 5:    Bagged OTU_5142  OTU_162 0.449131 2.82600e-04
## 6:    Bagged OTU_5142 OTU_4153 0.368088 3.51595e-03</code></pre>
<p>We process <code>coocurrence_data</code> by removing OTU interactions non-significant <span class="math inline">\(\rho\)</span> values by filtering out those with a <span class="math inline">\(p\)</span>-value less than <span class="math inline">\(0.05\)</span>, then filtering out cyanobacteria and choloroplast data, as well as all observations from bird samples:</p>
<pre class="r"><code>cooccurrence_data &lt;- cooccurrence_data[p &lt;= 0.05, -5]      # Remove p-values from table
cooccurrence_data &lt;- cooccurrence_data[order(treatment, OTU_1, OTU_2)]
remove &lt;- taxa[which(taxa[[4]] %in% c(&quot;Cyanobacteria&quot;,&quot;Chloroplast&quot;)),]$OTU
taxa &lt;- taxa[-c(remove),]
complete_data &lt;- cooccurrence_data[-c(which(apply(cooccurrence_data, 1, function(x) any(remove %in% x)))),]

bird_data &lt;- cooccurrence_data[treatment == &quot;Bird&quot;, ]
complete_data &lt;- cooccurrence_data[treatment != &quot;Bird&quot;, ]</code></pre>
<p>We then remove all edges that are <span class="math inline">\(\textit{not}\)</span> connected to the indicated OTUs of interest:</p>
<pre class="r"><code>otus_of_interest &lt;- c(&quot;Acinetobacter&quot;, &quot;Gluconobacter&quot;, &quot;Neokomagataea&quot;, &quot;erwinia&quot;, &quot;Pantoea&quot;, &quot;resenbergiella&quot;, &quot;Asaia&quot;, &quot;Lactobacillus&quot;, &quot;Pseudomonas&quot;)
otus_of_interest &lt;- taxa[which(apply(taxa, 1, function(x) any(otus_of_interest %in% x))),]$OTU
trimmed_data &lt;- complete_data[which(apply(complete_data, 1, function(x) any(otus_of_interest %in% x))), ]
head(trimmed_data)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho
## 1:    Bagged OTU_1018 OTU_1741 1.000000
## 2:    Bagged  OTU_105  OTU_153 0.269326
## 3:    Bagged OTU_1084 OTU_1741 0.701189
## 4:    Bagged OTU_1101  OTU_440 0.547866
## 5:    Bagged OTU_1228  OTU_153 0.269326
## 6:    Bagged OTU_1298 OTU_1385 0.416132</code></pre>
<p>We seperate the coocurrence data into a positive and negative group.</p>
<pre class="r"><code>trimmed_positive_weights &lt;- trimmed_data[trimmed_data[[&#39;rho&#39;]] &gt; 0]
head(trimmed_positive_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2      rho
## 1:    Bagged OTU_1018 OTU_1741 1.000000
## 2:    Bagged  OTU_105  OTU_153 0.269326
## 3:    Bagged OTU_1084 OTU_1741 0.701189
## 4:    Bagged OTU_1101  OTU_440 0.547866
## 5:    Bagged OTU_1228  OTU_153 0.269326
## 6:    Bagged OTU_1298 OTU_1385 0.416132</code></pre>
<pre class="r"><code>trimmed_negative_weights &lt;- trimmed_data[trimmed_data[[&#39;rho&#39;]] &lt; 0]
head(trimmed_negative_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2       rho
## 1:    Bagged  OTU_131   OTU_21 -0.287139
## 2:    Bagged   OTU_21   OTU_51 -0.255057
## 3:    Bagged   OTU_21  OTU_510 -0.311637
## 4:    Bagged    OTU_3    OTU_8 -0.261619
## 5:    Bagged OTU_4036 OTU_3492 -0.293861
## 6:    Bagged OTU_5257    OTU_8 -0.253046</code></pre>
<p>We’ll look at the positive and negative networks for each of the three treatments, as well as when all the treatments are combined together.</p>
</div>
<div id="patristic-distance-matrix" class="section level1">
<h1>Patristic Distance Matrix</h1>
<pre class="r"><code>library(ape, warn.conflicts = FALSE)</code></pre>
<p><code>bacteria_phylo_tree</code> is a guide tree returned by MAFFT for the bacterial sequences <a href="https://mafft.cbrc.jp/alignment/software/treeout.html">(info)</a>. We read it into a <code>phylo</code> object.</p>
<pre class="r"><code>rough_tree &lt;- read.tree(&quot;./data/bacteria/bacteria_phylo_tree&quot;)</code></pre>
<p>We use <code>cophenetic.phylo</code> to generate the patristic distances between each OTU. The patristic distance will be used as a measure of similarity as in the paper <a href="https://www.ncbi.nlm.nih.gov/pubmed/21775330">“Phylogenetic relatedness predicts priority effects in nectar yeast communities”</a>.</p>
<pre class="r"><code>pd_matrix &lt;- cophenetic.phylo(rough_tree)
rownames(pd_matrix) &lt;- sub(&quot;^[^_]*_&quot;, &quot;&quot;, rownames(pd_matrix)) 
colnames(pd_matrix) &lt;- sub(&quot;^[^_]*_&quot;, &quot;&quot;, colnames(pd_matrix))
pd_matrix[1:5, 1:5]</code></pre>
<pre><code>##            OTU_1 OTU_4369 OTU_4617 OTU_2588 OTU_4220
## OTU_1    0.00000  0.05576  0.07054  0.07400  0.07734
## OTU_4369 0.05576  0.00000  0.07054  0.07400  0.07734
## OTU_4617 0.07054  0.07054  0.00000  0.07400  0.07734
## OTU_2588 0.07400  0.07400  0.07400  0.00000  0.07734
## OTU_4220 0.07734  0.07734  0.07734  0.07734  0.00000</code></pre>
</div>
<div id="trimmed-data" class="section level1">
<h1>Trimmed Data</h1>
<p>All the following analysis is performed on the trimmed data set. Specifically, this analysis only examines interactions between <em>Acinetobacter, Gluconobacter, Neokomagataea, erwinia, Pantoea, resenbergiella, Asaia, Lactobacillus, Pseudomonas</em></p>
<div id="exposed-communities" class="section level2">
<h2>Exposed Communities</h2>
<div id="positive-weights" class="section level3">
<h3>Positive weights</h3>
<p>We create a directed graph weighted by Spearman correlation for the Exposed treatment for those OTUs that are positively correlated to each other:</p>
<pre class="r"><code>exposed_data_positive &lt;- trimmed_positive_weights[treatment == &quot;Exposed&quot;]
exposed_data_positive &lt;- exposed_data_positive[, -1]
gr_exposed_positive &lt;- graph.data.frame(exposed_data_positive, directed = FALSE)
plot(gr_exposed_positive, vertex.size = 3,
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tep.1-1.png" width="672" /></p>
<p>To determine communities, we use <code>cluster_fast_greedy</code>, which does greedy (local) optimization of the graph’s modularity score.</p>
<pre class="r"><code>exposed_communities_greedy_positive &lt;- cluster_fast_greedy(gr_exposed_positive, weights = E(gr_exposed_positive)$rho)
plot(exposed_communities_greedy_positive, gr_exposed_positive, 
     layout = layout.fruchterman.reingold(gr_exposed_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tep.2-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>(tep.mod &lt;- modularity(gr_exposed_positive, membership(exposed_communities_greedy_positive)))</code></pre>
<pre><code>## [1] 0.5247227</code></pre>
</div>
<div id="negative-weights" class="section level3">
<h3>Negative Weights</h3>
<p>We repeat the above process for the negatively correlated OTUs:</p>
<pre class="r"><code>exposed_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Exposed&quot;]
exposed_data_negative &lt;- exposed_data_negative[, -1]
exposed_data_negative[[3]] &lt;- abs(exposed_data_negative[[3]])
gr_exposed_negative &lt;- graph.data.frame(exposed_data_negative, directed = FALSE)
plot(gr_exposed_negative, vertex.size = 3,
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ten.1-1.png" width="672" /></p>
<pre class="r"><code>exposed_communities_greedy_negative &lt;- cluster_fast_greedy(gr_exposed_negative, weights = E(gr_exposed_negative)$rho)
plot(exposed_communities_greedy_negative, gr_exposed_negative, 
     layout = layout.fruchterman.reingold(gr_exposed_negative),
     vertex.size = 2, vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ten.2-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>(ten.mod &lt;- modularity(gr_exposed_negative, membership(exposed_communities_greedy_negative)))</code></pre>
<pre><code>## [1] 0.5118228</code></pre>
</div>
</div>
<div id="caged-communities" class="section level2">
<h2>Caged Communities</h2>
<div id="positive-weights-1" class="section level3">
<h3>Positive weights</h3>
<pre class="r"><code>plot(caged_communities_greedy_positive, gr_caged_positive, 
     layout = layout.fruchterman.reingold(gr_caged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
      )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tcp.2-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>(tcp.mod &lt;- modularity(gr_caged_positive, membership(caged_communities_greedy_positive)))</code></pre>
<pre><code>## [1] 0.5346598</code></pre>
</div>
<div id="negative-weights-1" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>caged_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Caged&quot;]
caged_data_negative &lt;- caged_data_negative[, -1]
caged_data_negative[[3]] &lt;- abs(caged_data_negative[[3]])
gr_caged_negative &lt;- graph.data.frame(caged_data_negative, directed = FALSE)
caged_communities_greedy_negative &lt;- cluster_fast_greedy(gr_caged_negative, weights = E(gr_caged_negative)$rho)
plot(caged_communities_greedy_negative, gr_caged_negative, 
     layout = layout.fruchterman.reingold(gr_caged_negative),
     vertex.size = 2, 
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tcn.1-1.png" width="672" /></p>
<p>The modularity of the community structure is:</p>
<pre class="r"><code>(tcn.mod &lt;- modularity(gr_caged_negative, membership(caged_communities_greedy_negative)))</code></pre>
<pre><code>## [1] 0.5193906</code></pre>
</div>
</div>
<div id="bagged-communities" class="section level2">
<h2>Bagged Communities</h2>
<div id="positive-weights-2" class="section level3">
<h3>Positive weights</h3>
<pre class="r"><code>bagged_data_positive &lt;- trimmed_positive_weights[treatment == &quot;Bagged&quot;]
bagged_data_positive &lt;- bagged_data_positive[, -1]
gr_bagged_positive &lt;- graph.data.frame(bagged_data_positive, directed = FALSE)
bagged_communities_greedy_positive &lt;- cluster_fast_greedy(gr_bagged_positive, weights = E(gr_bagged_positive)$rho)
plot(bagged_communities_greedy_positive, gr_bagged_positive, 
     layout = layout.fruchterman.reingold(gr_bagged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbp.1-1.png" width="672" /></p>
<p>The modularity score of the community structure is:</p>
<pre class="r"><code>(tbp.mod &lt;- modularity(gr_bagged_positive, membership(bagged_communities_greedy_positive)))</code></pre>
<pre><code>## [1] 0.4762388</code></pre>
</div>
<div id="negative-weights-2" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>bagged_data_negative &lt;- trimmed_negative_weights[treatment == &quot;Bagged&quot;]
bagged_data_negative &lt;- bagged_data_negative[, -1]
bagged_data_negative[[3]] &lt;- abs(bagged_data_negative[[3]])
gr_bagged_negative &lt;- graph.data.frame(bagged_data_negative, directed = FALSE)
bagged_communities_greedy_negative &lt;- cluster_fast_greedy(gr_bagged_negative, weights = E(gr_bagged_negative)$rho)
plot(bagged_communities_greedy_negative, gr_bagged_negative, 
     layout = layout.fruchterman.reingold(gr_bagged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbn.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>(tbn.mod &lt;- modularity(gr_bagged_negative, membership(bagged_communities_greedy_negative)))</code></pre>
<pre><code>## [1] 0.505102</code></pre>
</div>
</div>
<div id="all-treatments" class="section level2">
<h2>All Treatments</h2>
<p>We will now look at all treatments together. Note that data points from Bird samples have already been removed.</p>
<div id="positive-weights-3" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>trimmed_all_positive &lt;- trimmed_positive_weights[, -1]
gr_trimmed_all_positive &lt;- graph.data.frame(trimmed_all_positive, directed = FALSE)
trimmed_all_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_all_positive, 
                                    weights = E(gr_trimmed_all_positive)$rho)</code></pre>
<pre><code>## Error in cluster_fast_greedy(gr_trimmed_all_positive, weights = E(gr_trimmed_all_positive)$rho): At fast_community.c:639 : fast-greedy community finding works only on graphs without multiple edges, Invalid value</code></pre>
<p>Because all the treatments are being combined into one graph, there can be multiple (parallel) edges between OTUs. The clustering algorithm we have been using requires that there not be multiple edges between OTUs. We will collapse multiple edges by taking their mean - that is the mean correlation of the two OTUs across all treatments. (Are there potential problems with this collapsing rule?)</p>
<pre class="r"><code>gr_trimmed_all_positive &lt;- simplify(gr_trimmed_all_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_all_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_all_positive, 
                                    weights = E(gr_trimmed_all_positive)$rho)
plot(trimmed_all_positive_communities, gr_trimmed_all_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_all_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tap.2-1.png" width="672" /></p>
<p>What’s interesting here is that the graph has a lot of “spokes,” which hints at important OTUs.</p>
<p>Modularity score:</p>
<pre class="r"><code>(tap.mod &lt;- modularity(gr_trimmed_all_positive, membership(trimmed_all_positive_communities)))</code></pre>
<pre><code>## [1] 0.3177584</code></pre>
</div>
<div id="negative-weights-3" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>trimmed_all_negative &lt;- trimmed_negative_weights[, -1]
trimmed_all_negative[[3]] &lt;- abs(trimmed_all_negative[[3]])
gr_trimmed_all_negative &lt;- graph.data.frame(trimmed_all_negative, directed = FALSE)
gr_trimmed_all_negative &lt;- simplify(gr_trimmed_all_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_all_negative_communities &lt;- cluster_fast_greedy(gr_trimmed_all_negative, 
                                    weights = E(gr_trimmed_all_negative)$rho)
plot(trimmed_all_negative_communities, gr_trimmed_all_negative, 
     layout = layout.fruchterman.reingold(gr_trimmed_all_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tan.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>(tan.mod &lt;- modularity(gr_trimmed_all_negative, membership(trimmed_all_negative_communities)))</code></pre>
<pre><code>## [1] 0.4991163</code></pre>
</div>
</div>
</div>
<div id="complete-data" class="section level1">
<h1>Complete Data</h1>
<p>We reproduce the above analysis on the complete data sat. Again, we separate the data into positive and negative networks:</p>
<pre class="r"><code>complete_positive_weights &lt;- complete_data[complete_data[[&#39;rho&#39;]] &gt; 0]
head(complete_positive_weights)</code></pre>
<pre><code>##    treatment OTU_1    OTU_2      rho
## 1:    Bagged OTU_1 OTU_1000 0.271310
## 2:    Bagged OTU_1 OTU_1004 0.260951
## 3:    Bagged OTU_1 OTU_1028 0.493684
## 4:    Bagged OTU_1  OTU_105 0.404794
## 5:    Bagged OTU_1 OTU_1054 0.567432
## 6:    Bagged OTU_1 OTU_1071 0.390386</code></pre>
<pre class="r"><code>complete_negative_weights &lt;- complete_data[complete_data[[&#39;rho&#39;]] &lt; 0]
head(complete_negative_weights)</code></pre>
<pre><code>##    treatment    OTU_1    OTU_2       rho
## 1:    Bagged  OTU_131   OTU_21 -0.287139
## 2:    Bagged  OTU_131    OTU_5 -0.302685
## 3:    Bagged  OTU_131 OTU_5806 -0.274100
## 4:    Bagged   OTU_21   OTU_51 -0.255057
## 5:    Bagged   OTU_21  OTU_510 -0.311637
## 6:    Bagged OTU_2168 OTU_3913 -0.265874</code></pre>
<div id="exposed-communities-1" class="section level2">
<h2>Exposed Communities</h2>
<div id="positive-weights-4" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_exposed_positive &lt;- complete_positive_weights[treatment == &quot;Exposed&quot;]
complete_exposed_positive &lt;- complete_exposed_positive[, -1]
gr_complete_exposed_positive &lt;- graph.data.frame(complete_exposed_positive, directed = FALSE)
complete_exposed_positive_communities &lt;- cluster_fast_greedy(gr_complete_exposed_positive, 
                                                           weights = E(gr_complete_exposed_positive)$rho)
plot(complete_exposed_positive_communities, gr_complete_exposed_positive, 
     layout = layout.fruchterman.reingold(gr_complete_exposed_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cep.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(cep.mod &lt;- modularity(gr_complete_exposed_positive, membership(complete_exposed_positive_communities)))</code></pre>
<pre><code>## [1] 0.2484748</code></pre>
</div>
<div id="negative-weights-4" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_exposed_negative &lt;- complete_negative_weights[treatment == &quot;Exposed&quot;]
complete_exposed_negative &lt;- complete_exposed_negative[, -1]
complete_exposed_negative[[3]] &lt;- abs(complete_exposed_negative[[3]])
gr_complete_exposed_negative &lt;- graph.data.frame(complete_exposed_negative, directed = FALSE)
complete_exposed_negative_communities &lt;- cluster_fast_greedy(gr_complete_exposed_negative, 
                                                           weights = E(gr_complete_exposed_negative)$rho)
plot(complete_exposed_negative_communities, gr_complete_exposed_negative, 
     layout = layout.fruchterman.reingold(gr_complete_exposed_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cen.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(cen.mod &lt;- modularity(gr_complete_exposed_negative, membership(complete_exposed_negative_communities)))</code></pre>
<pre><code>## [1] 0.6004959</code></pre>
</div>
</div>
<div id="caged-communities-1" class="section level2">
<h2>Caged Communities</h2>
<div id="positive-weights-5" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_caged_positive &lt;- complete_positive_weights[treatment == &quot;Caged&quot;]
complete_caged_positive &lt;- complete_caged_positive[, -1]
gr_complete_caged_positive &lt;- graph.data.frame(complete_caged_positive, directed = FALSE)
complete_caged_positive_communities &lt;- cluster_fast_greedy(gr_complete_caged_positive, 
                                                           weights = E(gr_complete_caged_positive)$rho)
plot(complete_caged_positive_communities, gr_complete_caged_positive, 
     layout = layout.fruchterman.reingold(gr_complete_caged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ccp.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(ccp.mod &lt;- modularity(gr_complete_caged_positive, membership(complete_caged_positive_communities)))</code></pre>
<pre><code>## [1] 0.3459842</code></pre>
</div>
<div id="negative-weights-5" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_caged_negative &lt;- complete_negative_weights[treatment == &quot;Caged&quot;]
complete_caged_negative &lt;- complete_caged_negative[, -1]
complete_caged_negative[[3]] &lt;- abs(complete_caged_negative[[3]])
gr_complete_caged_negative &lt;- graph.data.frame(complete_caged_negative, directed = FALSE)
complete_caged_negative_communities &lt;- cluster_fast_greedy(gr_complete_caged_negative, 
                                                           weights = E(gr_complete_caged_negative)$rho)
plot(complete_caged_negative_communities, gr_complete_caged_negative, 
     layout = layout.fruchterman.reingold(gr_complete_caged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/ccn.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(ccn.mod &lt;- modularity(gr_complete_caged_negative, membership(complete_caged_negative_communities)))</code></pre>
<pre><code>## [1] 0.5346</code></pre>
</div>
</div>
<div id="bagged-communities-1" class="section level2">
<h2>Bagged Communities</h2>
<div id="positive-weights-6" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_bagged_positive &lt;- complete_positive_weights[treatment == &quot;Bagged&quot;]
complete_bagged_positive &lt;- complete_bagged_positive[, -1]
gr_complete_bagged_positive &lt;- graph.data.frame(complete_bagged_positive, directed = FALSE)
complete_bagged_positive_communities &lt;- cluster_fast_greedy(gr_complete_bagged_positive, 
                                                           weights = E(gr_complete_bagged_positive)$rho)
plot(complete_bagged_positive_communities, gr_complete_bagged_positive, 
     layout = layout.fruchterman.reingold(gr_complete_bagged_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbp.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(cbp.mod &lt;- modularity(gr_complete_bagged_positive, membership(complete_bagged_positive_communities)))</code></pre>
<pre><code>## [1] 0.3653204</code></pre>
</div>
<div id="negative-weights-6" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_bagged_negative &lt;- complete_negative_weights[treatment == &quot;Bagged&quot;]
complete_bagged_negative &lt;- complete_bagged_negative[, -1]
complete_bagged_negative[[3]] &lt;- abs(complete_bagged_negative[[3]])
gr_complete_bagged_negative &lt;- graph.data.frame(complete_bagged_negative, directed = FALSE)
complete_bagged_negative_communities &lt;- cluster_fast_greedy(gr_complete_bagged_negative, 
                                                           weights = E(gr_complete_bagged_negative)$rho)
plot(complete_bagged_negative_communities, gr_complete_bagged_negative, 
     layout = layout.fruchterman.reingold(gr_complete_bagged_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
     )</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbn.1-1.png" width="672" /></p>
<p>Modularity:</p>
<pre class="r"><code>(cbn.mod &lt;- modularity(gr_complete_bagged_negative, membership(complete_bagged_negative_communities)))</code></pre>
<pre><code>## [1] 0.6176386</code></pre>
</div>
</div>
<div id="all-treatments-1" class="section level2">
<h2>All Treatments</h2>
<div id="positive-weights-7" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>complete_all_positive &lt;- complete_positive_weights[, -1]
gr_complete_all_positive &lt;- graph.data.frame(complete_all_positive, directed = FALSE)
gr_complete_all_positive &lt;- simplify(gr_complete_all_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
complete_all_positive_communities &lt;- cluster_fast_greedy(gr_complete_all_positive, 
                                    weights = E(gr_complete_all_positive)$rho)
plot(complete_all_positive_communities, gr_complete_all_positive, 
     layout = layout.fruchterman.reingold(gr_complete_all_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cap.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>(cap.mod &lt;- modularity(gr_complete_all_positive, membership(complete_all_positive_communities)))</code></pre>
<pre><code>## [1] 0.1754305</code></pre>
</div>
<div id="negative-weights-7" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>complete_all_negative &lt;- complete_negative_weights[, -1]
complete_all_negative[[3]] &lt;- abs(complete_all_negative[[3]])
gr_complete_all_negative &lt;- graph.data.frame(complete_all_negative, directed = FALSE)
gr_complete_all_negative &lt;- simplify(gr_complete_all_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
complete_all_negative_communities &lt;- cluster_fast_greedy(gr_complete_all_negative, 
                                    weights = E(gr_complete_all_negative)$rho)
plot(complete_all_negative_communities, gr_complete_all_negative, 
     layout = layout.fruchterman.reingold(gr_complete_all_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/can.1-1.png" width="672" /></p>
<p>Modularity score:</p>
<pre class="r"><code>(can.mod &lt;- modularity(gr_complete_all_negative, membership(complete_all_negative_communities)))</code></pre>
<pre><code>## [1] 0.4837875</code></pre>
</div>
</div>
</div>
<div id="modularity" class="section level1">
<h1>Modularity</h1>
<p>Collecting all modularity scores:</p>
<pre class="r"><code>treatments &lt;- c(&quot;tep&quot;, &quot;ten&quot;, &quot;tcp&quot;, &quot;tcn&quot;, &quot;tbp&quot;, &quot;tbn&quot;, &quot;tap&quot;, &quot;tan&quot;,
                        &quot;cep&quot;, &quot;cen&quot;, &quot;ccp&quot;, &quot;ccn&quot;, &quot;cbp&quot;, &quot;cbn&quot;, &quot;cap&quot;, &quot;can&quot;)
scores &lt;- c(tep.mod, ten.mod, tcp.mod, tcn.mod, tbp.mod, tbn.mod, tap.mod, tan.mod,
            cep.mod, cen.mod, ccp.mod, ccn.mod, cbp.mod, cbn.mod, cap.mod, can.mod)
mod.scores &lt;- data.table(treatments, scores)


library(ggplot2, warn.conflicts = FALSE)
ggplot(mod.scores, aes(x = &quot;&quot;, y = scores)) + geom_boxplot() + 
    geom_jitter(shape = 16, aes(color = treatments))</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/mod.1-1.png" width="672" /></p>
</div>
<div id="birds" class="section level1">
<h1>Birds</h1>
<pre class="r"><code>bird_data &lt;- bird_data[, -1]
otus_of_interest &lt;- c(&quot;Acinetobacter&quot;, &quot;Gluconobacter&quot;, &quot;Neokomagataea&quot;, &quot;erwinia&quot;, &quot;Pantoea&quot;, &quot;resenbergiella&quot;, &quot;Asaia&quot;, &quot;Lactobacillus&quot;, &quot;Pseudomonas&quot;)
otus_of_interest &lt;- taxa[which(apply(taxa, 1, function(x) any(otus_of_interest %in% x))),]$OTU
trimmed_bird &lt;- bird_data[which(apply(complete_data, 1, function(x) any(otus_of_interest %in% x))),]</code></pre>
<div id="trimmed-data-1" class="section level2">
<h2>Trimmed Data</h2>
<div id="positive-weights-8" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>trimmed_bird_positive &lt;- trimmed_bird[trimmed_bird[[&#39;rho&#39;]] &gt; 0]
gr_trimmed_bird_positive &lt;- graph.data.frame(trimmed_bird_positive, directed = FALSE)
gr_trimmed_bird_positive &lt;- simplify(gr_trimmed_bird_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_bird_positive_communities &lt;- cluster_fast_greedy(gr_trimmed_bird_positive, 
                                    weights = E(gr_trimmed_bird_positive)$rho)
plot(trimmed_bird_positive_communities, gr_trimmed_bird_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdp.1-1.png" width="672" /></p>
<pre class="r"><code>plot(trimmed_bird_positive_communities, gr_trimmed_bird_positive, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label.cex = 1,
     vertex.label = ifelse(V(gr_trimmed_bird_positive)$name == &quot;OTU_6&quot;, 
                           V(gr_trimmed_bird_positive)$name, &quot;&quot;)
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdp.1-2.png" width="672" /></p>
</div>
<div id="negative-weights-8" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>trimmed_bird_negative &lt;- trimmed_bird[trimmed_bird[[&#39;rho&#39;]] &lt; 0]
trimmed_bird_negative[[3]] &lt;- abs(trimmed_bird_negative[[3]])
gr_trimmed_bird_negative &lt;- graph.data.frame(trimmed_bird_negative, directed = FALSE)
gr_trimmed_bird_negative &lt;- simplify(gr_trimmed_bird_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
trimmed_bird_negative_communities &lt;- cluster_fast_greedy(gr_trimmed_bird_negative, 
                                    weights = E(gr_trimmed_bird_negative)$rho)
plot(trimmed_bird_negative_communities, gr_trimmed_bird_negative, 
     layout = layout.fruchterman.reingold(gr_trimmed_bird_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label.cex = 0.25
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/tbdn.1-1.png" width="672" /></p>
<pre class="r"><code>gr_trimmed_bird_negative</code></pre>
<pre><code>## IGRAPH ac37f5b UN-- 14 10 -- 
## + attr: name (v/c), rho (e/n)
## + edges from ac37f5b (vertex names):
##  [1] OTU_20  --OTU_5917 OTU_3986--OTU_9    OTU_5776--OTU_9   
##  [4] OTU_580 --OTU_23   OTU_5806--OTU_23   OTU_5806--OTU_19  
##  [7] OTU_5806--OTU_25   OTU_5806--OTU_42   OTU_5806--OTU_43  
## [10] OTU_8   --OTU_13</code></pre>
<pre class="r"><code>taxa[OTU %in% c(&quot;OTU_4898&quot;, &quot;OTU_9&quot;)]</code></pre>
<pre><code>##      OTU   domain         phylum               class           order
## 1: OTU_9 Bacteria Proteobacteria Gammaproteobacteria Pseudomonadales
##              family       genus
## 1: Pseudomonadaceae Pseudomonas</code></pre>
</div>
</div>
<div id="complete-data-1" class="section level2">
<h2>Complete Data</h2>
<div id="positive-weights-9" class="section level3">
<h3>Positive Weights</h3>
<pre class="r"><code>bird_positive &lt;- bird_data[bird_data[[&#39;rho&#39;]] &gt; 0]
gr_bird_positive &lt;- graph.data.frame(bird_positive, directed = FALSE)
gr_bird_positive &lt;- simplify(gr_bird_positive, 
                                    edge.attr.comb = &quot;mean&quot;)
bird_positive_communities &lt;- cluster_fast_greedy(gr_bird_positive, 
                                    weights = E(gr_bird_positive)$rho)
plot(bird_positive_communities, gr_bird_positive, 
     layout = layout.fruchterman.reingold(gr_bird_positive),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbdp.1-1.png" width="672" /></p>
</div>
<div id="negative-weights-9" class="section level3">
<h3>Negative Weights</h3>
<pre class="r"><code>bird_negative &lt;- bird_data[bird_data[[&#39;rho&#39;]] &lt; 0]
bird_negative[[3]] &lt;- abs(bird_negative[[3]])
gr_bird_negative &lt;- graph.data.frame(bird_negative, directed = FALSE)
gr_bird_negative &lt;- simplify(gr_bird_negative, 
                                    edge.attr.comb = &quot;mean&quot;)
bird_negative_communities &lt;- cluster_fast_greedy(gr_bird_negative, 
                                    weights = E(gr_bird_negative)$rho)
plot(bird_negative_communities, gr_bird_negative, 
     layout = layout.fruchterman.reingold(gr_bird_negative),
     rescaled = TRUE,
     vertex.size = 2, 
     vertex.label = NA
)</code></pre>
<p><img src="bacteria_community_analysis_files/figure-html/cbdn.1-1.png" width="672" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
