---
title: "Creating Cooccurrence for our Bacteria OTUs""
---

```{r setup, include=FALSE}
set.seed(1390)
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, message = FALSE, warning = FALSE}
library(phyloseq, warn.conflicts = FALSE)
```

```{r load_data}
otus <- read.table("data/bacteria/germs_otus/bac_cdhit_otu_table_wide.txt", header=TRUE)
rownames(otus) <- otus$OTUS
otus <- otus[,-1]
```

## Combining OTU data with Taxonomy

Next we read in the taxonimical classifications for each OTU, as well as the sample metadata. The taxonomic data is merged with `rbind` so that it is a single file with OTUs as the rownames and domain through genus as the columns.

```{r add_info}
tax <- read.delim("data/bacteria/germs_otus/bac_cdhit_taxa_table_w_repseq.txt")[,-1]
row.names(tax) <- as.character(tax$OTUS)
tax <- tax[,-1]
```

## Sample Data
```{r}
si <- read.csv("data/bacteria/Data_for_bacterial_OTUs.csv")
colnames(si) <- c("sample", "Flower", "Treatment", "sample.name")
rownames(si) <- paste("X", si$sample, sep="")
si <- si[,-1]
```

## Creating Phyloseq Objects
OTU tables need to be read in as matrices, so only the counts, with taxa(OTUs) as rownames.
<br>
Taxa need to be read in as matrix, with taxa as rownames.
<br>
Sample data is read as a data frame with sample names as rownames.

```{r phyloseq, message=FALSE}
phylo <- phyloseq(otu_table(as.matrix(otus), taxa_are_rows=T), tax_table(as.matrix(tax)), sample_data(si))
rarefied_phylo <- rarefy_even_depth(phylo, sample.size = 500)
saveRDS(rarefied_phylo,"data/bacteria/germs_otus/bacteria_phyloseq.rds")
```

## Co-Ocurrence

```{r co_ocurrence}
trt <- as.character(sample_data(rarefied_phylo)$Treatment)
f_table <- cbind(trt, t(otu_table(rarefied_phylo)))
write.csv(f_table, "data/bacteria/germs_otus/bac_fcoocurr_input.csv")
```

